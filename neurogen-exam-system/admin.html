<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒè¯•ç³»ç»Ÿåå°ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: white;
            border: none;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid transparent;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .question-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .question-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        .question-item h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .question-item p {
            margin-bottom: 8px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ’¼ ç©†æ¡¥é”€å”®æµ‹éªŒç³»ç»Ÿ - åå°ç®¡ç†</h1>
        <p>é¢˜åº“ç®¡ç† | APIé…ç½® | æ•°æ®ç»Ÿè®¡</p>
    </div>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">ğŸ“Š æ•°æ®æ¦‚è§ˆ</button>
            <button class="nav-tab" onclick="switchTab('questions')">ğŸ“ é¢˜åº“ç®¡ç†</button>
            <button class="nav-tab" onclick="switchTab('import')">ğŸ“¤ æ‰¹é‡å¯¼å…¥</button>
            <button class="nav-tab" onclick="switchTab('api')">âš™ï¸ APIé…ç½®</button>
        </div>

        <!-- æ•°æ®æ¦‚è§ˆ -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalQuestions">0</div>
                    <div class="stat-label">é¢˜åº“æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="singleQuestions">0</div>
                    <div class="stat-label">å•é€‰é¢˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="multipleQuestions">0</div>
                    <div class="stat-label">å¤šé€‰é¢˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCategories">0</div>
                    <div class="stat-label">çŸ¥è¯†åˆ†ç±»</div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“ˆ é¢˜åº“åˆ†å¸ƒ</h2>
                <div id="categoryStats"></div>
            </div>
        </div>

        <!-- é¢˜åº“ç®¡ç† -->
        <div id="questions" class="tab-content">
            <div class="card">
                <h2>â• æ·»åŠ æ–°é¢˜ç›®</h2>
                <form id="questionForm">
                    <div class="form-group">
                        <label>é¢˜ç›®ç±»å‹</label>
                        <select id="questionType">
                            <option value="single">å•é€‰é¢˜</option>
                            <option value="multiple">å¤šé€‰é¢˜</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>çŸ¥è¯†åˆ†ç±»</label>
                        <input type="text" id="questionCategory" placeholder="å¦‚ï¼šç–¾ç—…ã€è¯ç‰©ã€æ²»ç–—ç­‰" required>
                    </div>
                    
                    <div class="form-group">
                        <label>é¢˜ç›®å†…å®¹</label>
                        <textarea id="questionText" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰é¡¹A</label>
                        <input type="text" id="optionA" placeholder="é€‰é¡¹Aå†…å®¹" required>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰é¡¹B</label>
                        <input type="text" id="optionB" placeholder="é€‰é¡¹Bå†…å®¹" required>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰é¡¹C</label>
                        <input type="text" id="optionC" placeholder="é€‰é¡¹Cå†…å®¹" required>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰é¡¹D</label>
                        <input type="text" id="optionD" placeholder="é€‰é¡¹Då†…å®¹" required>
                    </div>
                    
                    <div class="form-group">
                        <label>æ­£ç¡®ç­”æ¡ˆ</label>
                        <input type="text" id="correctAnswer" placeholder="å•é€‰é¢˜è¾“å…¥ï¼šA å¤šé€‰é¢˜è¾“å…¥ï¼šABC" required>
                        <small style="color: #666;">æç¤ºï¼šå•é€‰é¢˜è¾“å…¥ä¸€ä¸ªå­—æ¯ï¼Œå¤šé€‰é¢˜è¾“å…¥å¤šä¸ªå­—æ¯</small>
                    </div>
                    
                    <div class="form-group">
                        <label>ç­”æ¡ˆè§£æ</label>
                        <textarea id="questionExplanation" placeholder="è¯·æä¾›ç­”æ¡ˆè§£æ"></textarea>
                    </div>
                    
                    <button type="submit" class="btn">ğŸ’¾ ä¿å­˜é¢˜ç›®</button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">ğŸ”„ æ¸…ç©ºè¡¨å•</button>
                </form>
            </div>

            <div class="card">
                <h2>ğŸ“‹ é¢˜åº“åˆ—è¡¨ (<span id="questionCount">0</span>é¢˜)</h2>
                <div class="question-list" id="questionList"></div>
            </div>
        </div>

        <!-- æ‰¹é‡å¯¼å…¥ -->
        <div id="import" class="tab-content">
            <div class="card">
                <h2>ğŸ“¤ Excelæ‰¹é‡å¯¼å…¥</h2>
                <div style="border: 2px dashed #667eea; border-radius: 10px; padding: 40px; text-align: center; background: #f8f9ff; cursor: pointer; transition: all 0.3s ease;" 
                     onclick="document.getElementById('excelFileInput').click()" 
                     ondrop="handleFileDrop(event)" 
                     ondragover="event.preventDefault(); this.style.borderColor='#4CAF50'; this.style.background='#f0fff0';" 
                     ondragleave="this.style.borderColor='#667eea'; this.style.background='#f8f9ff';">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“Š</div>
                    <h3>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤å¤„</h3>
                    <p>æ”¯æŒ .xlsx, .xls æ ¼å¼</p>
                    <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleExcelUpload(event)">
                </div>
                
                <div id="uploadProgress" style="display: none; margin-top: 20px;">
                    <div style="background: #e0e0e0; border-radius: 10px; overflow: hidden;">
                        <div id="progressBar" style="height: 20px; background: linear-gradient(45deg, #667eea, #764ba2); width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                    <p id="progressText" style="text-align: center; margin-top: 10px; color: #666;">æ­£åœ¨å¤„ç†...</p>
                </div>
                
                <div id="importResults" style="display: none; margin-top: 20px;"></div>
            </div>

            <div class="card">
                <h2>ğŸ“‹ Excelæ ¼å¼è¦æ±‚</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">âœ… ä½ çš„Excelæ ¼å¼å®Œç¾æ”¯æŒï¼</h3>
                    <p><strong>å½“å‰æ”¯æŒçš„Excelåˆ—ç»“æ„ï¼š</strong></p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 15px 0;">
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #667eea;">
                            <strong>åˆ—A:</strong> é¢˜ç›®ç±»åˆ«<br>
                            <small>å¦‚ï¼šç–¾ç—…ã€è¯ç‰©ã€æ²»ç–—</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #667eea;">
                            <strong>åˆ—B:</strong> é¢˜ç›®ç±»å‹<br>
                            <small>å•é€‰é¢˜/å¤šé€‰é¢˜</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #667eea;">
                            <strong>åˆ—C:</strong> é¢˜ç›®å†…å®¹<br>
                            <small>å®Œæ•´çš„é¢˜ç›®æè¿°</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #667eea;">
                            <strong>åˆ—D:</strong> æ­£ç¡®ç­”æ¡ˆ<br>
                            <small>å•é€‰ï¼šAï¼Œå¤šé€‰ï¼šABC</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #28a745;">
                            <strong>åˆ—E:</strong> é€‰é¡¹A<br>
                            <small>ç¬¬ä¸€ä¸ªé€‰é¡¹å†…å®¹</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #28a745;">
                            <strong>åˆ—F:</strong> é€‰é¡¹B<br>
                            <small>ç¬¬äºŒä¸ªé€‰é¡¹å†…å®¹</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #28a745;">
                            <strong>åˆ—G:</strong> é€‰é¡¹C<br>
                            <small>ç¬¬ä¸‰ä¸ªé€‰é¡¹å†…å®¹</small>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 5px; border-left: 3px solid #28a745;">
                            <strong>åˆ—H:</strong> é€‰é¡¹D<br>
                            <small>ç¬¬å››ä¸ªé€‰é¡¹å†…å®¹</small>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7;">
                    <h4 style="color: #856404; margin-bottom: 10px;">ğŸ’¡ å¯¼å…¥æç¤º</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #856404;">
                        <li>ç¬¬ä¸€è¡Œä¸ºæ ‡é¢˜è¡Œï¼Œä¼šè‡ªåŠ¨è·³è¿‡</li>
                        <li>æ”¯æŒå•é€‰é¢˜ï¼ˆç­”æ¡ˆå¦‚ï¼šAã€Bã€Cã€Dï¼‰</li>
                        <li>æ”¯æŒå¤šé€‰é¢˜ï¼ˆç­”æ¡ˆå¦‚ï¼šABCã€ADã€BCç­‰ï¼‰</li>
                        <li>ç©ºè¡Œä¼šè‡ªåŠ¨è·³è¿‡</li>
                        <li>å»ºè®®ä¸€æ¬¡å¯¼å…¥ä¸è¶…è¿‡500é“é¢˜ç›®</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ”„ GitHubåœ¨çº¿é¢˜åº“åŒæ­¥</h2>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #2196f3;">
                    <h3 style="color: #1976d2; margin-bottom: 15px;">ğŸ” GitHubé…ç½®</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">GitHub Token:</label>
                        <input type="password" id="githubToken" placeholder="è¾“å…¥GitHub Personal Access Token" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px;">
                        <small style="color: #666;">
                            è·å–æ–¹å¼ï¼šGitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ ç”Ÿæˆæ–°Token (éœ€è¦repoæƒé™)
                        </small>
                    </div>
                    <button onclick="saveGitHubConfig()" style="background: #2196f3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                        ğŸ’¾ ä¿å­˜é…ç½®
                    </button>
                    <span id="githubConfigStatus" style="color: #666; margin-left: 10px;"></span>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">ğŸš€ è‡ªåŠ¨åŒæ­¥</h3>
                    <p>ä¸€é”®å°†é¢˜åº“åŒæ­¥åˆ°GitHubï¼Œæ‰€æœ‰é”€å”®è®¾å¤‡å°†è‡ªåŠ¨è·å¾—æœ€æ–°é¢˜åº“</p>
                    <button onclick="autoSyncToGitHub()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; margin-right: 10px; font-size: 16px;">
                        ğŸ”„ ç«‹å³åŒæ­¥åˆ°GitHub
                    </button>
                    <button onclick="exportQuestionBank()" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        ğŸ“¤ å¯¼å‡ºå¤‡ä»½
                    </button>
                    <div id="syncStatus" style="margin-top: 10px; font-size: 14px;"></div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ’¾ é¢˜åº“å¯¼å‡º/å¯¼å…¥</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #007bff; margin-bottom: 15px;">ğŸ“¤ å¯¼å‡ºé¢˜åº“</h3>
                    <p>å°†å½“å‰é¢˜åº“å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼Œå¯åœ¨å…¶ä»–è®¾å¤‡å¯¼å…¥ä½¿ç”¨</p>
                    <button id="exportBtn" onclick="exportQuestionBank()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        ğŸ“¤ å¯¼å‡ºé¢˜åº“
                    </button>
                    <span id="exportStatus" style="color: #666;"></span>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: #28a745; margin-bottom: 15px;">ğŸ“¥ å¯¼å…¥é¢˜åº“</h3>
                    <p>é€‰æ‹©ä¹‹å‰å¯¼å‡ºçš„é¢˜åº“JSONæ–‡ä»¶è¿›è¡Œå¯¼å…¥</p>
                    <input type="file" id="jsonFileInput" accept=".json" style="margin-bottom: 10px;" onchange="handleJsonUpload(event)">
                    <br>
                    <button id="importBtn" onclick="importQuestionBank()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        ğŸ“¥ å¯¼å…¥é¢˜åº“
                    </button>
                    <span id="importStatus" style="color: #666;"></span>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7;">
                    <h4 style="color: #856404; margin-bottom: 10px;">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #856404;">
                        <li>å¯¼å‡ºçš„æ–‡ä»¶åŒ…å«æ‰€æœ‰é¢˜ç›®ä¿¡æ¯ï¼Œå¯åœ¨ä»»ä½•è®¾å¤‡å¯¼å…¥</li>
                        <li>å¯¼å…¥ä¼š<strong>è¦†ç›–</strong>å½“å‰é¢˜åº“ï¼Œè¯·è°¨æ…æ“ä½œ</li>
                        <li>å»ºè®®å®šæœŸå¯¼å‡ºé¢˜åº“ä½œä¸ºå¤‡ä»½</li>
                        <li>å›¢é˜Ÿæˆå‘˜å¯ä»¥å…±äº«å¯¼å‡ºçš„é¢˜åº“æ–‡ä»¶</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“‹ å¯¼å…¥å†å²è®°å½•</h2>
                <div id="importHistory">
                    <p style="color: #666; text-align: center; padding: 20px;">æš‚æ— å¯¼å…¥è®°å½•</p>
                </div>
            </div>
        </div>

        <!-- APIé…ç½® -->
        <div id="api" class="tab-content">
            <div class="card">
                <h2>ğŸ”— APIæœåŠ¡é…ç½®</h2>
                <div class="form-group">
                    <label>APIæœåŠ¡å•†</label>
                    <select id="apiProvider" onchange="updateApiConfig()">
                        <option value="openai">OpenAI (GPT-3.5/GPT-4)</option>
                        <option value="qwen">é€šä¹‰åƒé—® (Qwen)</option>
                        <option value="zhipu">æ™ºè°±AI (GLM)</option>
                        <option value="proxy">ä»£ç†æœåŠ¡å™¨ (æ¨è)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>APIåœ°å€</label>
                    <input type="text" id="apiUrl" placeholder="https://api.openai.com/v1/chat/completions">
                </div>
                
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" id="apiKey" placeholder="è¯·è¾“å…¥API Key">
                </div>
                
                <div class="form-group">
                    <label>æ¨¡å‹åç§°</label>
                    <input type="text" id="modelName" placeholder="gpt-3.5-turbo">
                </div>
                
                <button class="btn" onclick="saveApiConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-secondary" onclick="testApiConnection()">ğŸ” æµ‹è¯•è¿æ¥</button>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border: 1px solid #ffeaa7;">
                    <h4 style="color: #856404; margin-bottom: 10px;">âš ï¸ é‡è¦æç¤º</h4>
                    <p style="color: #856404; margin: 0; font-size: 14px;">
                        <strong>å…³äºCORSé™åˆ¶ï¼š</strong><br>
                        â€¢ OpenAI API: æ”¯æŒæµè§ˆå™¨ç›´æ¥è°ƒç”¨<br>
                        â€¢ é€šä¹‰åƒé—®/æ™ºè°±AI: å—CORSé™åˆ¶ï¼Œéœ€è¦ä»£ç†æœåŠ¡å™¨<br>
                        â€¢ ä»£ç†æœåŠ¡å™¨: é€šè¿‡Verceléƒ¨ç½²ï¼Œè§£å†³CORSé—®é¢˜ï¼ˆæ¨èï¼‰<br>
                        â€¢ å¦‚é‡åˆ°CORSé”™è¯¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æœ¬åœ°è¯„ä¼°æŠ¥å‘Š
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div id="alertContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let questionBank = [];
        let currentEditingId = null;
        let importHistory = [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            loadQuestionBank();
            loadApiConfig();
            loadImportHistory();
            updateDashboard();
            showAllQuestions();
        });

        // Excelæ–‡ä»¶ä¸Šä¼ å¤„ç†
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processExcelFile(file);
            }
        }

        // æ‹–æ‹½æ–‡ä»¶å¤„ç†
        function handleFileDrop(event) {
            event.preventDefault();
            event.target.style.borderColor = '#667eea';
            event.target.style.background = '#f8f9ff';
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processExcelFile(files[0]);
            }
        }

        // å¤„ç†Excelæ–‡ä»¶
        function processExcelFile(file) {
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                showAlert('è¯·é€‰æ‹©Excelæ–‡ä»¶ï¼ˆ.xlsxæˆ–.xlsæ ¼å¼ï¼‰', 'error');
                return;
            }

            showProgress(true);
            updateProgress(10, 'æ­£åœ¨è¯»å–Excelæ–‡ä»¶...');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    updateProgress(30, 'æ­£åœ¨è§£æExcelæ•°æ®...');
                    
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è½¬æ¢ä¸ºJSONæ•°ç»„
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    updateProgress(50, 'æ­£åœ¨å¤„ç†é¢˜ç›®æ•°æ®...');
                    
                    // è§£æé¢˜ç›®æ•°æ®
                    const questions = parseExcelData(jsonData);
                    
                    updateProgress(80, 'æ­£åœ¨ä¿å­˜é¢˜ç›®...');
                    
                    // å¯¼å…¥é¢˜ç›®
                    importQuestions(questions, file.name);
                    
                    updateProgress(100, 'å¯¼å…¥å®Œæˆï¼');
                    
                    setTimeout(() => {
                        showProgress(false);
                        showImportResults(questions.length, file.name);
                    }, 1000);
                    
                } catch (error) {
                    console.error('è§£æExcelæ–‡ä»¶å‡ºé”™:', error);
                    showProgress(false);
                    showAlert('Excelæ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
                }
            };
            
            reader.onerror = function() {
                showProgress(false);
                showAlert('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
            };
            
            reader.readAsArrayBuffer(file);
        }

        // è§£æExcelæ•°æ®
        function parseExcelData(jsonData) {
            const questions = [];
            
            // è·³è¿‡æ ‡é¢˜è¡Œï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                
                // è·³è¿‡ç©ºè¡Œ
                if (!row || row.length < 6 || !row[0] || !row[2]) {
                    continue;
                }
                
                try {
                    const question = {
                        id: Date.now() + i, // ç”Ÿæˆå”¯ä¸€ID
                        category: String(row[0]).trim(), // é¢˜ç›®ç±»åˆ«
                        type: String(row[1]).includes('å¤šé€‰') ? 'multiple' : 'single', // é¢˜ç›®ç±»å‹
                        question: String(row[2]).trim(), // é¢˜ç›®å†…å®¹
                        options: [
                            String(row[4] || '').trim(), // é€‰é¡¹A
                            String(row[5] || '').trim(), // é€‰é¡¹B
                            String(row[6] || '').trim(), // é€‰é¡¹C
                            String(row[7] || '').trim()  // é€‰é¡¹D
                        ].filter(opt => opt), // è¿‡æ»¤ç©ºé€‰é¡¹
                        correct: parseCorrectAnswer(String(row[3]).trim()), // æ­£ç¡®ç­”æ¡ˆ
                        explanation: '' // æš‚æ—¶ä¸ºç©ºï¼Œå¯ä»¥åç»­æ·»åŠ 
                    };
                    
                    // éªŒè¯é¢˜ç›®æ•°æ®
                    if (question.options.length >= 2 && question.correct.length > 0) {
                        questions.push(question);
                    }
                    
                } catch (error) {
                    console.warn(`ç¬¬${i + 1}è¡Œæ•°æ®è§£æå¤±è´¥:`, error);
                }
            }
            
            return questions;
        }

        // è§£ææ­£ç¡®ç­”æ¡ˆ
        function parseCorrectAnswer(answerStr) {
            const answer = answerStr.toUpperCase();
            const correctIndexes = [];
            
            for (let char of answer) {
                if (char >= 'A' && char <= 'D') {
                    const index = char.charCodeAt(0) - 65; // A=0, B=1, C=2, D=3
                    if (!correctIndexes.includes(index)) {
                        correctIndexes.push(index);
                    }
                }
            }
            
            return correctIndexes;
        }

        // å¯¼å…¥é¢˜ç›®åˆ°é¢˜åº“
        function importQuestions(questions, fileName) {
            const beforeCount = questionBank.length;
            
            // æ·»åŠ åˆ°é¢˜åº“
            questionBank = questionBank.concat(questions);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveQuestionBank();
            
            // è®°å½•å¯¼å…¥å†å²
            const importRecord = {
                id: Date.now(),
                fileName: fileName,
                importTime: new Date().toLocaleString(),
                count: questions.length,
                totalBefore: beforeCount,
                totalAfter: questionBank.length
            };
            
            importHistory.unshift(importRecord);
            saveImportHistory();
            
            // æ›´æ–°ç•Œé¢
            updateDashboard();
            showAllQuestions();
            updateImportHistory();
        }

        // æ˜¾ç¤ºå¯¼å…¥ç»“æœ
        function showImportResults(count, fileName) {
            const resultsDiv = document.getElementById('importResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div style="background: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px;">
                    <h3 style="margin-bottom: 15px;">ğŸ‰ å¯¼å…¥æˆåŠŸï¼</h3>
                    <p><strong>æ–‡ä»¶å:</strong> ${fileName}</p>
                    <p><strong>å¯¼å…¥é¢˜ç›®æ•°:</strong> ${count} é“</p>
                    <p><strong>å½“å‰æ€»é¢˜ç›®æ•°:</strong> ${questionBank.length} é“</p>
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="switchTab('questions')">ğŸ“ æŸ¥çœ‹é¢˜åº“</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importResults').style.display='none'">å…³é—­</button>
                    </div>
                </div>
            `;
            
            showAlert(`æˆåŠŸå¯¼å…¥ ${count} é“é¢˜ç›®ï¼`, 'success');
        }

        // æ˜¾ç¤º/éšè—è¿›åº¦æ¡
        function showProgress(show) {
            document.getElementById('uploadProgress').style.display = show ? 'block' : 'none';
            if (!show) {
                updateProgress(0, '');
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }

        // ä¿å­˜å¯¼å…¥å†å²
        function saveImportHistory() {
            localStorage.setItem('importHistory', JSON.stringify(importHistory));
        }

        // åŠ è½½å¯¼å…¥å†å²
        function loadImportHistory() {
            const saved = localStorage.getItem('importHistory');
            if (saved) {
                importHistory = JSON.parse(saved);
            }
        }

        // æ›´æ–°å¯¼å…¥å†å²æ˜¾ç¤º
        function updateImportHistory() {
            const historyDiv = document.getElementById('importHistory');
            
            if (importHistory.length === 0) {
                historyDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">æš‚æ— å¯¼å…¥è®°å½•</p>';
                return;
            }
            
            historyDiv.innerHTML = importHistory.map(record => `
                <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: #f8f9fa;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #667eea; margin: 0;">${record.fileName}</h4>
                        <span style="color: #666; font-size: 12px;">${record.importTime}</span>
                    </div>
                    <p style="margin: 5px 0; color: #666;">
                        å¯¼å…¥é¢˜ç›®: <strong>${record.count}</strong> é“ | 
                        å¯¼å…¥å‰: ${record.totalBefore} é“ | 
                        å¯¼å…¥å: ${record.totalAfter} é“
                    </p>
                </div>
            `).join('');
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡æ ‡ç­¾å†…å®¹
            document.getElementById(tabName).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”æ ‡ç­¾æŒ‰é’®
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°æ•°æ®æ¦‚è§ˆï¼Œæ›´æ–°ç»Ÿè®¡
            if (tabName === 'dashboard') {
                updateDashboard();
            }
            
            // å¦‚æœåˆ‡æ¢åˆ°é¢˜åº“ç®¡ç†ï¼Œåˆ·æ–°é¢˜ç›®åˆ—è¡¨
            if (tabName === 'questions') {
                showAllQuestions();
            }
            
            // å¦‚æœåˆ‡æ¢åˆ°å¯¼å…¥é¡µé¢ï¼Œæ›´æ–°å¯¼å…¥å†å²
            if (tabName === 'import') {
                updateImportHistory();
            }
        }

        // æ›´æ–°æ•°æ®æ¦‚è§ˆ
        function updateDashboard() {
            const stats = calculateStats();
            
            document.getElementById('totalQuestions').textContent = stats.total;
            document.getElementById('singleQuestions').textContent = stats.single;
            document.getElementById('multipleQuestions').textContent = stats.multiple;
            document.getElementById('totalCategories').textContent = stats.categories;
            
            // æ˜¾ç¤ºåˆ†ç±»ç»Ÿè®¡
            const categoryDiv = document.getElementById('categoryStats');
            categoryDiv.innerHTML = '';
            
            if (Object.keys(stats.categoryCount).length === 0) {
                categoryDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">æš‚æ— æ•°æ®</p>';
                return;
            }
            
            Object.entries(stats.categoryCount).forEach(([category, count]) => {
                const categoryItem = document.createElement('div');
                categoryItem.style.cssText = 'display: flex; justify-content: space-between; padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 5px;';
                categoryItem.innerHTML = `<span>${category}</span><span><strong>${count}é¢˜</strong></span>`;
                categoryDiv.appendChild(categoryItem);
            });
        }

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        function calculateStats() {
            const stats = {
                total: questionBank.length,
                single: 0,
                multiple: 0,
                categories: 0,
                categoryCount: {}
            };
            
            questionBank.forEach(q => {
                if (q.type === 'single') stats.single++;
                if (q.type === 'multiple') stats.multiple++;
                
                if (!stats.categoryCount[q.category]) {
                    stats.categoryCount[q.category] = 0;
                }
                stats.categoryCount[q.category]++;
            });
            
            stats.categories = Object.keys(stats.categoryCount).length;
            
            return stats;
        }

        // ä¿å­˜é¢˜ç›®
        document.getElementById('questionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: currentEditingId || Date.now(),
                type: document.getElementById('questionType').value,
                category: document.getElementById('questionCategory').value,
                question: document.getElementById('questionText').value,
                options: [
                    document.getElementById('optionA').value,
                    document.getElementById('optionB').value,
                    document.getElementById('optionC').value,
                    document.getElementById('optionD').value
                ],
                correct: [],
                explanation: document.getElementById('questionExplanation').value
            };
            
            // å¤„ç†æ­£ç¡®ç­”æ¡ˆ
            const correctAnswer = document.getElementById('correctAnswer').value.toUpperCase();
            formData.correct = correctAnswer.split('').map(letter => letter.charCodeAt(0) - 65);
            
            // éªŒè¯æ•°æ®
            if (formData.options.some(opt => !opt.trim())) {
                showAlert('æ‰€æœ‰é€‰é¡¹éƒ½å¿…é¡»å¡«å†™', 'error');
                return;
            }
            
            if (formData.correct.some(x => x >= 4 || x < 0)) {
                showAlert('æ­£ç¡®ç­”æ¡ˆå¿…é¡»æ˜¯Aã€Bã€Cã€Dä¸­çš„å­—æ¯', 'error');
                return;
            }
            
            // ä¿å­˜æˆ–æ›´æ–°é¢˜ç›®
            if (currentEditingId) {
                const index = questionBank.findIndex(q => q.id === currentEditingId);
                questionBank[index] = formData;
                currentEditingId = null;
            } else {
                questionBank.push(formData);
            }
            
            saveQuestionBank();
            showAlert('é¢˜ç›®ä¿å­˜æˆåŠŸ', 'success');
            clearForm();
            showAllQuestions();
            updateDashboard();
        });

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('questionForm').reset();
            currentEditingId = null;
        }

        // æ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®
        function showAllQuestions() {
            const container = document.getElementById('questionList');
            const countElement = document.getElementById('questionCount');
            
            container.innerHTML = '';
            countElement.textContent = questionBank.length;
            
            if (questionBank.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">æš‚æ— é¢˜ç›®ï¼Œè¯·æ·»åŠ é¢˜ç›®</p>';
                return;
            }
            
            questionBank.forEach(question => {
                const questionDiv = createQuestionElement(question);
                container.appendChild(questionDiv);
            });
        }

        // åˆ›å»ºé¢˜ç›®å…ƒç´ 
        function createQuestionElement(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            
            const correctLetters = question.correct.map(i => String.fromCharCode(65 + i)).join('');
            
            div.innerHTML = `
                <h3>[${question.category}] ${question.type === 'single' ? 'å•é€‰é¢˜' : 'å¤šé€‰é¢˜'}</h3>
                <p><strong>é¢˜ç›®ï¼š</strong>${question.question}</p>
                <p><strong>é€‰é¡¹ï¼š</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    ${question.options.map((option, index) => 
                        `<li style="margin: 5px 0; ${question.correct.includes(index) ? 'color: #28a745; font-weight: bold;' : ''}">${String.fromCharCode(65 + index)}. ${option}</li>`
                    ).join('')}
                </ul>
                <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>${correctLetters}</p>
                ${question.explanation ? `<p><strong>è§£æï¼š</strong>${question.explanation}</p>` : ''}
                <div style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="editQuestion(${question.id})">âœï¸ ç¼–è¾‘</button>
                    <button class="btn btn-danger" onclick="deleteQuestion(${question.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                </div>
            `;
            
            return div;
        }

        // ç¼–è¾‘é¢˜ç›®
        function editQuestion(id) {
            const question = questionBank.find(q => q.id === id);
            if (!question) return;
            
            currentEditingId = id;
            
            // å¡«å……è¡¨å•
            document.getElementById('questionType').value = question.type;
            document.getElementById('questionCategory').value = question.category;
            document.getElementById('questionText').value = question.question;
            document.getElementById('optionA').value = question.options[0] || '';
            document.getElementById('optionB').value = question.options[1] || '';
            document.getElementById('optionC').value = question.options[2] || '';
            document.getElementById('optionD').value = question.options[3] || '';
            document.getElementById('questionExplanation').value = question.explanation || '';
            document.getElementById('correctAnswer').value = question.correct.map(i => String.fromCharCode(65 + i)).join('');
            
            // åˆ‡æ¢åˆ°é¢˜åº“ç®¡ç†æ ‡ç­¾
            switchTab('questions');
            
            // æ»šåŠ¨åˆ°è¡¨å•
            document.getElementById('questionForm').scrollIntoView({ behavior: 'smooth' });
            
            showAlert('é¢˜ç›®å·²è½½å…¥ç¼–è¾‘å™¨', 'success');
        }

        // åˆ é™¤é¢˜ç›®
        function deleteQuestion(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) {
                questionBank = questionBank.filter(q => q.id !== id);
                saveQuestionBank();
                showAllQuestions();
                updateDashboard();
                showAlert('é¢˜ç›®åˆ é™¤æˆåŠŸ', 'success');
            }
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; min-width: 250px;';
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // ä¿å­˜é¢˜åº“åˆ°æœ¬åœ°å­˜å‚¨
        function saveQuestionBank() {
            localStorage.setItem('questionBank', JSON.stringify(questionBank));
        }

        // ä¿å­˜GitHubé…ç½®
        function saveGitHubConfig() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                showAlert('è¯·è¾“å…¥GitHub Token', 'error');
                return;
            }
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('githubToken', token);
            showAlert('GitHubé…ç½®å·²ä¿å­˜', 'success');
            document.getElementById('githubConfigStatus').textContent = 'âœ… å·²é…ç½®';
            document.getElementById('githubConfigStatus').style.color = '#28a745';
        }

        // åŠ è½½GitHubé…ç½®
        function loadGitHubConfig() {
            const token = localStorage.getItem('githubToken');
            if (token) {
                document.getElementById('githubToken').value = token;
                document.getElementById('githubConfigStatus').textContent = 'âœ… å·²é…ç½®';
                document.getElementById('githubConfigStatus').style.color = '#28a745';
            }
        }

        // è‡ªåŠ¨åŒæ­¥åˆ°GitHub
        async function autoSyncToGitHub() {
            const token = localStorage.getItem('githubToken');
            
            if (!token) {
                showAlert('è¯·å…ˆé…ç½®GitHub Token', 'error');
                return;
            }
            
            if (questionBank.length === 0) {
                showAlert('é¢˜åº“ä¸ºç©ºï¼Œæ— æ³•åŒæ­¥', 'error');
                return;
            }
            
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.innerHTML = 'ğŸ”„ æ­£åœ¨åŒæ­¥åˆ°GitHub...';
            syncStatus.style.color = '#007bff';
            
            try {
                // è·å–å½“å‰æ–‡ä»¶çš„SHAï¼ˆç”¨äºæ›´æ–°æ–‡ä»¶ï¼‰
                const currentFileResponse = await fetch('https://api.github.com/repos/Eddie318/Neurogen_test_system/contents/questionbank.json', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                if (currentFileResponse.ok) {
                    const currentFile = await currentFileResponse.json();
                    sha = currentFile.sha;
                }
                
                // å‡†å¤‡æ›´æ–°çš„å†…å®¹
                const content = JSON.stringify(questionBank, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                // æ›´æ–°æ–‡ä»¶
                const updateResponse = await fetch('https://api.github.com/repos/Eddie318/Neurogen_test_system/contents/questionbank.json', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `è‡ªåŠ¨åŒæ­¥é¢˜åº“ - ${new Date().toLocaleString()} (${questionBank.length}é“é¢˜)`,
                        content: encodedContent,
                        sha: sha
                    })
                });
                
                if (updateResponse.ok) {
                    showAlert(`é¢˜åº“åŒæ­¥æˆåŠŸï¼å…±åŒæ­¥ ${questionBank.length} é“é¢˜ç›®`, 'success');
                    syncStatus.innerHTML = `âœ… åŒæ­¥æˆåŠŸ (${questionBank.length}é“é¢˜) - ${new Date().toLocaleString()}`;
                    syncStatus.style.color = '#28a745';
                } else {
                    const errorData = await updateResponse.json();
                    throw new Error(`GitHub APIé”™è¯¯: ${errorData.message}`);
                }
                
            } catch (error) {
                console.error('åŒæ­¥å¤±è´¥:', error);
                showAlert(`åŒæ­¥å¤±è´¥: ${error.message}`, 'error');
                syncStatus.innerHTML = `âŒ åŒæ­¥å¤±è´¥: ${error.message}`;
                syncStatus.style.color = '#dc3545';
            }
        }

        // è€ç‰ˆæœ¬çš„åŒæ­¥å‡½æ•°ï¼ˆä¿ç•™ä½œä¸ºå¤‡ç”¨ï¼‰
        async function syncQuestionBankToGitHub() {
            showAlert('è¯·ä½¿ç”¨ä¸Šæ–¹çš„"ç«‹å³åŒæ­¥åˆ°GitHub"åŠŸèƒ½', 'error');
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½é¢˜åº“
        function loadQuestionBank() {
            const saved = localStorage.getItem('questionBank');
            if (saved) {
                questionBank = JSON.parse(saved);
            }
        }

        // æ›´æ–°APIé…ç½®
        function updateApiConfig() {
            const provider = document.getElementById('apiProvider').value;
            const urlInput = document.getElementById('apiUrl');
            const modelInput = document.getElementById('modelName');
            
            switch (provider) {
                case 'openai':
                    urlInput.value = 'https://api.openai.com/v1/chat/completions';
                    modelInput.value = 'gpt-3.5-turbo';
                    break;
                case 'qwen':
                    urlInput.value = 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation';
                    modelInput.value = 'qwen-turbo';
                    break;
                case 'zhipu':
                    urlInput.value = 'https://open.bigmodel.cn/api/paas/v4/chat/completions';
                    modelInput.value = 'glm-4';
                    break;
                case 'proxy':
                    urlInput.value = 'https://neurogen-qwen.vercel.app/api/proxy';
                    modelInput.value = 'qwen-turbo';
                    break;
            }
        }

        // ä¿å­˜APIé…ç½®
        function saveApiConfig() {
            const config = {
                provider: document.getElementById('apiProvider').value,
                url: document.getElementById('apiUrl').value,
                key: document.getElementById('apiKey').value,
                model: document.getElementById('modelName').value
            };
            
            localStorage.setItem('apiConfig', JSON.stringify(config));
            showAlert('APIé…ç½®ä¿å­˜æˆåŠŸ', 'success');
            
            // è‡ªåŠ¨åŒæ­¥APIé…ç½®åˆ°GitHub
            syncApiConfigToGitHub();
        }

        // åŒæ­¥APIé…ç½®åˆ°GitHub
        async function syncApiConfigToGitHub() {
            const token = localStorage.getItem('githubToken');
            if (!token) {
                console.log('æœªé…ç½®GitHub Tokenï¼Œè·³è¿‡APIé…ç½®åŒæ­¥');
                return;
            }
            
            const apiConfig = JSON.parse(localStorage.getItem('apiConfig') || '{}');
            
            // ä¸åŒæ­¥API Keyåˆ°GitHubï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
            const publicConfig = {
                provider: apiConfig.provider,
                url: apiConfig.url,
                model: apiConfig.model,
                lastUpdated: new Date().toISOString()
            };
            
            try {
                // è·å–å½“å‰æ–‡ä»¶çš„SHA
                const currentFileResponse = await fetch('https://api.github.com/repos/Eddie318/Neurogen_test_system/contents/apiconfig.json', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = null;
                if (currentFileResponse.ok) {
                    const currentFile = await currentFileResponse.json();
                    sha = currentFile.sha;
                }
                
                // å‡†å¤‡æ›´æ–°çš„å†…å®¹
                const content = JSON.stringify(publicConfig, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                // æ›´æ–°æ–‡ä»¶
                const updateResponse = await fetch('https://api.github.com/repos/Eddie318/Neurogen_test_system/contents/apiconfig.json', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `è‡ªåŠ¨åŒæ­¥APIé…ç½® - ${new Date().toLocaleString()}`,
                        content: encodedContent,
                        sha: sha
                    })
                });
                
                if (updateResponse.ok) {
                    console.log('APIé…ç½®åŒæ­¥åˆ°GitHubæˆåŠŸ');
                } else {
                    console.error('APIé…ç½®åŒæ­¥å¤±è´¥:', await updateResponse.text());
                }
                
            } catch (error) {
                console.error('APIé…ç½®åŒæ­¥å¤±è´¥:', error);
            }
        }

        // åŠ è½½APIé…ç½®
        function loadApiConfig() {
            const saved = localStorage.getItem('apiConfig');
            if (saved) {
                const config = JSON.parse(saved);
                document.getElementById('apiProvider').value = config.provider || 'openai';
                document.getElementById('apiUrl').value = config.url || '';
                document.getElementById('apiKey').value = config.key || '';
                document.getElementById('modelName').value = config.model || '';
            }
            updateApiConfig();
        }

        // æµ‹è¯•APIè¿æ¥
        function testApiConnection() {
            const config = {
                url: document.getElementById('apiUrl').value,
                key: document.getElementById('apiKey').value,
                model: document.getElementById('modelName').value
            };
            
            if (!config.key) {
                showAlert('è¯·å…ˆè¾“å…¥API Key', 'error');
                return;
            }
            
            showAlert('æ­£åœ¨æµ‹è¯•APIè¿æ¥...', 'success');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIæµ‹è¯•é€»è¾‘
            setTimeout(() => {
                showAlert('APIè¿æ¥æµ‹è¯•å®Œæˆï¼ˆè¯·åœ¨è€ƒè¯•ç³»ç»Ÿä¸­éªŒè¯å®é™…åŠŸèƒ½ï¼‰', 'success');
            }, 2000);
        }

        // å¯¼å‡ºé¢˜åº“ä¸ºJSON
        function exportQuestionBank() {
            if (questionBank.length === 0) {
                showAlert('é¢˜åº“ä¸ºç©ºï¼Œæ— æ³•å¯¼å‡º', 'error');
                document.getElementById('exportStatus').textContent = 'é¢˜åº“ä¸ºç©º';
                return;
            }
            
            const dataStr = JSON.stringify(questionBank, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ç©†æ¡¥é”€å”®é¢˜åº“_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showAlert('é¢˜åº“å¯¼å‡ºæˆåŠŸ', 'success');
            document.getElementById('exportStatus').textContent = `å·²å¯¼å‡º ${questionBank.length} é“é¢˜ç›®`;
        }

        // å¤„ç†JSONæ–‡ä»¶ä¸Šä¼ 
        let selectedJsonFile = null;
        
        function handleJsonUpload(event) {
            selectedJsonFile = event.target.files[0];
            if (selectedJsonFile) {
                document.getElementById('importStatus').textContent = `å·²é€‰æ‹©: ${selectedJsonFile.name}`;
            }
        }

        // å¯¼å…¥é¢˜åº“ä»JSON
        function importQuestionBank() {
            if (!selectedJsonFile) {
                showAlert('è¯·å…ˆé€‰æ‹©JSONæ–‡ä»¶', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!Array.isArray(importedData)) {
                        throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼šåº”ä¸ºé¢˜ç›®æ•°ç»„');
                    }
                    
                    // éªŒè¯é¢˜ç›®ç»“æ„
                    let validCount = 0;
                    const validQuestions = importedData.filter(item => {
                        if (item && item.question && item.answer && item.optionA && item.optionB) {
                            validCount++;
                            return true;
                        }
                        return false;
                    });
                    
                    if (validQuestions.length === 0) {
                        throw new Error('æ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é¢˜ç›®æ•°æ®');
                    }
                    
                    // ç¡®è®¤å¯¼å…¥
                    if (confirm(`ç¡®å®šè¦å¯¼å…¥ ${validQuestions.length} é“é¢˜ç›®å—ï¼Ÿ\nè¿™å°†è¦†ç›–å½“å‰é¢˜åº“çš„æ‰€æœ‰å†…å®¹ï¼`)) {
                        questionBank = validQuestions;
                        saveQuestionBank();
                        updateDashboard();
                        showAlert(`é¢˜åº“å¯¼å…¥æˆåŠŸï¼Œå…±å¯¼å…¥ ${validQuestions.length} é“é¢˜ç›®`, 'success');
                        document.getElementById('importStatus').textContent = `å¯¼å…¥æˆåŠŸï¼š${validQuestions.length} é“é¢˜ç›®`;
                        
                        // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                        document.getElementById('jsonFileInput').value = '';
                        selectedJsonFile = null;
                    }
                    
                } catch (error) {
                    showAlert(`å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
                    document.getElementById('importStatus').textContent = 'å¯¼å…¥å¤±è´¥';
                }
            };
            
            reader.readAsText(selectedJsonFile);
        }

        // æ·»åŠ å¯¼å‡ºæŒ‰é’®åˆ°æ•°æ®æ¦‚è§ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const dashboardCard = document.querySelector('#dashboard .card:last-child');
            if (dashboardCard) {
                const exportBtn = document.createElement('button');
                exportBtn.className = 'btn btn-success';
                exportBtn.textContent = 'ğŸ“¤ å¯¼å‡ºé¢˜åº“';
                exportBtn.onclick = exportQuestionBank;
                dashboardCard.appendChild(exportBtn);
            }
            
            // åŠ è½½GitHubé…ç½®
            loadGitHubConfig();
        });
    </script>
</body>
</html>