#!/bin/bash

# ç©†æ¡¥é”€å”®æµ‹éªŒç³»ç»Ÿ - ç§»åŠ¨ç«¯å¿«é€Ÿå¯åŠ¨

echo "=================================================="
echo "      ç©†æ¡¥é”€å”®æµ‹éªŒç³»ç»Ÿ - ç§»åŠ¨ç«¯å¯åŠ¨"
echo "=================================================="

# æ£€æŸ¥Python
if ! command -v python3 &> /dev/null; then
    echo "âŒ Python3 æœªå®‰è£…"
    exit 1
fi

# è·å–æœ¬æœºIP
LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | awk '{print $2}' | head -1)

if [ -z "$LOCAL_IP" ]; then
    echo "âŒ æ— æ³•è·å–æœ¬æœºIPåœ°å€"
    echo "è¯·ç¡®ä¿ç”µè„‘å·²è¿æ¥åˆ°WiFiç½‘ç»œ"
    exit 1
fi

# åœæ­¢ç°æœ‰æœåŠ¡
pkill -f "python.*8000" || true

# å¯åŠ¨æœåŠ¡å™¨
echo "ğŸš€ å¯åŠ¨ç§»åŠ¨ç«¯å‹å¥½çš„WebæœåŠ¡å™¨..."
python3 -m http.server 8000 --bind 0.0.0.0 &
HTTP_PID=$!

sleep 3

echo ""
echo "âœ… å¯åŠ¨æˆåŠŸï¼"
echo ""
echo "ğŸ“± æ‰‹æœºè®¿é—®åœ°å€ï¼š"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚  é”€å”®è€ƒè¯•ï¼šhttp://${LOCAL_IP}:8000/exam.html?mode=sales    â”‚"
echo "â”‚  ç®¡ç†åå°ï¼šhttp://${LOCAL_IP}:8000/admin.html              â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ“‹ ä½¿ç”¨æ­¥éª¤ï¼š"
echo "1ï¸âƒ£  ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€WiFiç½‘ç»œ"
echo "2ï¸âƒ£  åœ¨æ‰‹æœºæµè§ˆå™¨æ‰“å¼€ä¸Šé¢çš„é”€å”®è€ƒè¯•åœ°å€"
echo "3ï¸âƒ£  å»ºè®®å°†åœ°å€æ·»åŠ åˆ°æ‰‹æœºä¸»å±å¹•"
echo ""
echo "ğŸ’¡ æ·»åŠ åˆ°ä¸»å±å¹•æ–¹æ³•ï¼š"
echo "   iOS: æµè§ˆå™¨èœå• â†’ æ·»åŠ åˆ°ä¸»å±å¹•"
echo "   Android: æµè§ˆå™¨èœå• â†’ æ·»åŠ å¿«æ·æ–¹å¼"
echo ""
echo "ğŸ›‘ åœæ­¢æœåŠ¡ï¼šæŒ‰ Ctrl+C"
echo ""

# ç­‰å¾…ç”¨æˆ·ä¸­æ–­
trap "echo ''; echo 'æ­£åœ¨åœæ­¢æœåŠ¡...'; kill $HTTP_PID 2>/dev/null; exit 0" INT

# ä¿æŒè„šæœ¬è¿è¡Œ
wait