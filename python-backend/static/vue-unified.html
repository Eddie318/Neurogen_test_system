<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç©†æ¡¥é”€å”®æµ‹éªŒç³»ç»Ÿ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px; margin-bottom: 30px; }
        .nav-tabs { display: flex; background: white; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; }
        .nav-tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease; color: #718096; font-weight: 500; border-bottom: 3px solid transparent; }
        .nav-tab:hover { background: #f8f9ff; color: #667eea; }
        .nav-tab.active { background: #667eea; color: white; border-bottom-color: #5a67d8; }
        .nav-tab.hidden { display: none; }
        .card { background: white; border-radius: 10px; padding: 30px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        /* è€ƒè¯•ç•Œé¢æ ·å¼ */
        .question { font-size: 18px; line-height: 1.6; margin-bottom: 20px; color: #333; }
        .options { display: grid; gap: 15px; }
        .option { padding: 15px 20px; border: 2px solid #e1e8ed; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; background: #fafbfc; }
        .option:hover { border-color: #667eea; background: #f8f9ff; }
        .option.selected { border-color: #667eea; background: #667eea; color: white; }
        .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 30px; }
        .btn { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: all 0.3s ease; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; }
        .btn-success { background: #48bb78; color: white; }
        .btn-success:hover { background: #38a169; }
        .btn-secondary { background: #a0aec0; color: white; }
        .btn-secondary:hover { background: #718096; }
        .btn-danger { background: #f56565; color: white; }
        .btn-danger:hover { background: #e53e3e; }
        .progress-bar { width: 100%; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s ease; }
        .timer { font-size: 18px; font-weight: bold; color: #e53e3e; }
        .result-card { text-align: center; }
        .loading { text-align: center; padding: 40px; }
        .spinner { border: 4px solid #f3f4f6; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* ç®¡ç†ç•Œé¢æ ·å¼ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; }
        .stat-value { font-size: 32px; font-weight: bold; color: #4c51bf; margin-bottom: 10px; }
        .stat-label { color: #718096; font-size: 14px; }
        .tabs { display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 30px; }
        .tab { padding: 15px 25px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; color: #718096; }
        .tab.active { color: #4c51bf; border-bottom-color: #4c51bf; font-weight: bold; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .table th { background: #f7fafc; font-weight: bold; color: #4a5568; }
        .table tr:hover { background: #f7fafc; }
        .search-box { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 6px; margin-bottom: 20px; font-size: 16px; }
        .search-box:focus { outline: none; border-color: #4c51bf; }
        .score-badge { padding: 4px 8px; border-radius: 4px; color: white; font-weight: bold; }
        .score-excellent { background: #48bb78; }
        .score-good { background: #ed8936; }
        .score-poor { background: #f56565; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #4a5568; }
        .form-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 16px; }
        .form-input:focus { outline: none; border-color: #4c51bf; }
        .form-input.error { border-color: #f56565; }
        .form-textarea { min-height: 100px; resize: vertical; }
        .error-message { color: #f56565; font-size: 14px; margin-top: 5px; }
        
        /* é¢˜åº“å¡ç‰‡æ ·å¼ */
        .question-banks-list { display: grid; gap: 15px; }
        .bank-card { 
            background: white; 
            border: 2px solid #e2e8f0; 
            border-radius: 8px; 
            padding: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start;
            transition: all 0.3s ease;
        }
        .bank-card:hover { border-color: #4c51bf; box-shadow: 0 4px 12px rgba(76, 81, 191, 0.15); }
        .bank-info h4 { margin: 0 0 8px 0; color: #2d3748; font-size: 18px; }
        .bank-info p { margin: 0 0 12px 0; color: #718096; font-size: 14px; }
        .bank-stats { display: flex; gap: 20px; flex-wrap: wrap; }
        .stat-item { color: #4a5568; font-size: 13px; }
        .bank-actions { display: flex; gap: 8px; }
        .btn-sm { padding: 8px 16px; font-size: 14px; }
        
        /* é¢˜ç›®ç®¡ç†æ ·å¼ */
        .questions-list { max-height: 400px; overflow-y: auto; }
        .question-item { 
            background: #f8f9fa; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            padding: 15px; 
            margin-bottom: 15px; 
        }
        .question-header { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
            margin-bottom: 8px; 
            font-size: 14px; 
        }
        .question-number { font-weight: bold; color: #4c51bf; }
        .question-type { 
            background: #4c51bf; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
        }
        .question-category { 
            background: #48bb78; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
        }
        .question-content { 
            font-weight: 500; 
            margin-bottom: 10px; 
            color: #2d3748; 
            line-height: 1.5; 
        }
        .question-options { margin-bottom: 10px; }
        .option { 
            padding: 5px 10px; 
            margin: 2px 0; 
            border-radius: 4px; 
            font-size: 14px; 
        }
        .option.correct { 
            background: #c6f6d5; 
            color: #22543d; 
            font-weight: 500; 
        }
        .question-actions { display: flex; justify-content: flex-end; }
        .no-data { 
            text-align: center; 
            padding: 40px; 
            color: #718096; 
        }
        
        /* é¢˜ç›®ç®¡ç†å™¨æ ‡ç­¾é¡µ */
        .mode-tabs { display: flex; gap: 0; border-bottom: 2px solid #e2e8f0; margin-bottom: 0; }
        .mode-tab { 
            padding: 10px 20px; 
            border: none; 
            background: none; 
            cursor: pointer; 
            border-bottom: 3px solid transparent; 
            color: #718096; 
            transition: all 0.3s ease;
        }
        .mode-tab:hover { color: #4a5568; background: #f7fafc; }
        .mode-tab.active { 
            color: #4c51bf; 
            border-bottom-color: #4c51bf; 
            background: #f0fff4; 
        }
        
        /* æœç´¢æ¡† */
        .search-input { 
            padding: 8px 12px; 
            border: 2px solid #e2e8f0; 
            border-radius: 6px; 
            font-size: 14px; 
            width: 250px;
        }
        .search-input:focus { outline: none; border-color: #4c51bf; }
        
        /* é¢˜ç›®çŠ¶æ€æ ·å¼ */
        .question-item.already-added { 
            opacity: 0.7; 
            background: #f0f0f0; 
        }
        .added-badge { 
            background: #48bb78; 
            color: white; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            margin-left: auto;
        }
        
        /* æ¯æ—¥æµ‹éªŒç‰¹æ®Šæ ·å¼ */
        .mode-selection { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .mode-card { padding: 30px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; text-align: center; background: white; }
        .mode-card:hover { border-color: #667eea; background: #f8f9ff; }
        .mode-card.selected { border-color: #667eea; background: #667eea; color: white; }
        .mode-icon { font-size: 48px; margin-bottom: 15px; }
        .mode-title { font-size: 20px; font-weight: bold; margin-bottom: 10px; }
        .mode-desc { color: #718096; font-size: 14px; }
        .mode-card.selected .mode-desc { color: rgba(255,255,255,0.8); }
        
        .answer-review { margin-top: 30px; }
        .answer-item { border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 15px; }
        .answer-question { font-weight: bold; margin-bottom: 15px; color: #2d3748; }
        .answer-options { display: grid; gap: 10px; margin-bottom: 15px; }
        .answer-option { padding: 10px 15px; border-radius: 6px; border: 1px solid #e2e8f0; }
        .answer-option.correct { background: #c6f6d5; border-color: #48bb78; color: #2f855a; }
        .answer-option.wrong { background: #fed7d7; border-color: #f56565; color: #c53030; }
        .answer-option.not-selected { background: #f7fafc; color: #718096; }
        .answer-explanation { background: #f0fff4; border: 1px solid #9ae6b4; border-radius: 6px; padding: 15px; margin-top: 10px; }
        .ai-report { background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-top: 20px; white-space: pre-wrap; line-height: 1.6; }
        .ai-loading { text-align: center; padding: 20px; color: #718096; }
        
        .checkbox, .radio { 
            width: 20px; 
            height: 20px; 
            border: 2px solid #e1e8ed; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 12px; 
            font-weight: bold;
            flex-shrink: 0;
            background: white;
            color: transparent;
        }
        .checkbox { border-radius: 4px; }
        .radio { border-radius: 50%; }
        .checkbox.checked, .radio.checked { 
            background: #667eea; 
            color: white; 
            border-color: #667eea; 
        }
        .option.selected .checkbox, .option.selected .radio { 
            background: #667eea; 
            color: white; 
            border-color: #667eea; 
        }
        
        .question-type-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            margin-left: 15px;
        }
        .question-type-badge.single-choice {
            background: #48bb78;
        }
        .question-type-badge.multiple-choice {
            background: #ed8936;
        }
        
        .btn-disabled { 
            opacity: 0.5; 
            cursor: not-allowed !important; 
        }
        .btn-disabled:hover { 
            background: #667eea !important; 
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header { padding: 20px; }
            .card { padding: 20px; }
            .controls { flex-direction: column; gap: 15px; }
            .btn { width: 100%; }
            .mode-selection { grid-template-columns: 1fr; }
            .nav-tabs { flex-direction: column; }
            .nav-tab { border-bottom: none; border-right: 3px solid transparent; }
            .nav-tab.active { border-right-color: #5a67d8; border-bottom: none; }
            .stats-grid { grid-template-columns: 1fr; }
            .tabs { flex-wrap: wrap; }
            .table { font-size: 14px; overflow-x: auto; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- æ ‡é¢˜ -->
            <div class="header">
                <h1>ğŸ“… ç©†æ¡¥é”€å”®æµ‹éªŒç³»ç»Ÿ</h1>
                <p>åŒ»è¯ä»£è¡¨æ¯æ—¥æµ‹éªŒå¹³å° - æ¬¢è¿ {{ userName }}</p>
            </div>

            <!-- ä¸»å¯¼èˆªæ ‡ç­¾ -->
            <div class="nav-tabs">
                <div class="nav-tab" :class="{ active: currentMainTab === 'exam' }" @click="switchMainTab('exam')">
                    ğŸ“ è€ƒè¯•æµ‹éªŒ
                </div>
                <div class="nav-tab" :class="{ active: currentMainTab === 'admin', hidden: !isAdmin }" @click="switchMainTab('admin')" v-show="isAdmin">
                    ğŸ“Š ç®¡ç†åå°
                </div>
            </div>

            <!-- è€ƒè¯•æ¨¡å— -->
            <div v-if="currentMainTab === 'exam'">
                <!-- æ¯æ—¥æµ‹éªŒå…¥å£ -->
                <div v-if="currentView === 'daily-home'" class="card">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 72px; margin-bottom: 20px;">ğŸ“…</div>
                        <h2 style="color: #4a5568; margin-bottom: 15px;">æ¯æ—¥æµ‹éªŒ</h2>
                        <p style="color: #718096; margin-bottom: 30px; font-size: 16px;">
                            æ¯å¤©3é“ä¸“ä¸šé¢˜ç›®ï¼Œ10åˆ†é’Ÿé™æ—¶ç­”é¢˜<br>
                            å¼€æ”¾æ—¶é—´ï¼š{{ dailyExamTime }}
                        </p>
                        
                        <div v-if="!isExamTimeActive" style="background: #fed7d7; color: #c53030; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            â° å½“å‰ä¸åœ¨è€ƒè¯•æ—¶é—´å†…ï¼Œè¯·åœ¨ {{ dailyExamTime }} æ—¶é—´æ®µå†…å‚åŠ æµ‹éªŒ
                        </div>
                        
                        <button 
                            class="btn btn-success" 
                            @click="startDailyExam"
                            :disabled="!isExamTimeActive"
                            style="font-size: 18px; padding: 15px 40px;"
                        >
                            {{ isExamTimeActive ? 'ğŸš€ å¼€å§‹ä»Šæ—¥æµ‹éªŒ' : 'â° ç­‰å¾…å¼€æ”¾æ—¶é—´' }}
                        </button>
                        
                        <div v-if="todayExamRecord" style="margin-top: 30px; padding: 20px; background: #f0fff4; border-radius: 8px;">
                            <h4 style="color: #38a169; margin-bottom: 10px;">âœ… ä»Šæ—¥å·²å®Œæˆæµ‹éªŒ</h4>
                            <p style="color: #4a5568;">
                                å¾—åˆ†ï¼š{{ todayExamRecord.score }}åˆ† | 
                                ç”¨æ—¶ï¼š{{ formatDuration(todayExamRecord.duration) }} |
                                ç­”å¯¹ï¼š{{ todayExamRecord.correctCount }}/{{ todayExamRecord.totalQuestions }}é¢˜
                            </p>
                        </div>
                    </div>
                </div>

                <!-- è€ƒè¯•è¿›è¡Œä¸­ -->
                <div v-if="currentView === 'exam-in-progress'" class="card">
                    <!-- è¿›åº¦æ¡ -->
                    <div class="progress-bar">
                        <div class="progress-fill" :style="{width: progressPercent + '%'}"></div>
                    </div>
                    
                    <!-- è€ƒè¯•ä¿¡æ¯ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <span>ç¬¬ {{ currentQuestionIndex + 1 }} / {{ questions.length }} é¢˜</span>
                        <div class="timer">â° {{ formatTime(timeRemaining) }}</div>
                    </div>

                    <!-- é¢˜ç›®å†…å®¹ -->
                    <div v-if="currentQuestion">
                        <div class="question">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <strong>{{ currentQuestion.question }}</strong>
                                <span class="question-type-badge" 
                                      :class="currentQuestion && currentQuestion.type === 'multiple' ? 'multiple-choice' : 'single-choice'">
                                    {{ currentQuestion && currentQuestion.type === 'multiple' ? 'å¤šé€‰é¢˜' : 'å•é€‰é¢˜' }}
                                </span>
                            </div>
                            <div v-if="currentQuestion && currentQuestion.type === 'multiple'" 
                                 style="color: #718096; font-size: 14px; margin-bottom: 15px;">
                                è¯·é€‰æ‹©æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ
                            </div>
                        </div>
                        
                        <div class="options">
                            <!-- é€‰é¡¹A -->
                            <div v-if="currentQuestion && currentQuestion.optionA"
                                 class="option"
                                 :class="{ selected: isOptionSelected('A') }"
                                 @click="selectAnswer('A')">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div v-if="currentQuestion && currentQuestion.type === 'multiple'" 
                                         class="checkbox"
                                         :class="{ checked: isOptionSelected('A') }">
                                        âœ“
                                    </div>
                                    <div v-else-if="currentQuestion" 
                                         class="radio"
                                         :class="{ checked: isOptionSelected('A') }">
                                        <span v-if="isOptionSelected('A')" style="font-size: 8px;">â—</span>
                                    </div>
                                    <div>
                                        <strong>A.</strong> {{ currentQuestion.optionA }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- é€‰é¡¹B -->
                            <div v-if="currentQuestion && currentQuestion.optionB"
                                 class="option"
                                 :class="{ selected: isOptionSelected('B') }"
                                 @click="selectAnswer('B')">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div v-if="currentQuestion && currentQuestion.type === 'multiple'" 
                                         class="checkbox"
                                         :class="{ checked: isOptionSelected('B') }">
                                        âœ“
                                    </div>
                                    <div v-else-if="currentQuestion" 
                                         class="radio"
                                         :class="{ checked: isOptionSelected('B') }">
                                        <span v-if="isOptionSelected('B')" style="font-size: 8px;">â—</span>
                                    </div>
                                    <div>
                                        <strong>B.</strong> {{ currentQuestion.optionB }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- é€‰é¡¹C -->
                            <div v-if="currentQuestion && currentQuestion.optionC"
                                 class="option"
                                 :class="{ selected: isOptionSelected('C') }"
                                 @click="selectAnswer('C')">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div v-if="currentQuestion && currentQuestion.type === 'multiple'" 
                                         class="checkbox"
                                         :class="{ checked: isOptionSelected('C') }">
                                        âœ“
                                    </div>
                                    <div v-else-if="currentQuestion" 
                                         class="radio"
                                         :class="{ checked: isOptionSelected('C') }">
                                        <span v-if="isOptionSelected('C')" style="font-size: 8px;">â—</span>
                                    </div>
                                    <div>
                                        <strong>C.</strong> {{ currentQuestion.optionC }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- é€‰é¡¹D -->
                            <div v-if="currentQuestion && currentQuestion.optionD"
                                 class="option"
                                 :class="{ selected: isOptionSelected('D') }"
                                 @click="selectAnswer('D')">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div v-if="currentQuestion && currentQuestion.type === 'multiple'" 
                                         class="checkbox"
                                         :class="{ checked: isOptionSelected('D') }">
                                        âœ“
                                    </div>
                                    <div v-else-if="currentQuestion" 
                                         class="radio"
                                         :class="{ checked: isOptionSelected('D') }">
                                        <span v-if="isOptionSelected('D')" style="font-size: 8px;">â—</span>
                                    </div>
                                    <div>
                                        <strong>D.</strong> {{ currentQuestion.optionD }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div class="controls">
                        <button 
                            class="btn btn-primary" 
                            @click="previousQuestion"
                            :disabled="currentQuestionIndex === 0"
                        >
                            ä¸Šä¸€é¢˜
                        </button>
                        
                        <span>{{ answeredCount }} / {{ questions.length }} å·²ç­”</span>
                        
                        <button 
                            v-if="currentQuestionIndex < questions.length - 1"
                            class="btn btn-primary" 
                            @click="nextQuestion"
                        >
                            ä¸‹ä¸€é¢˜
                        </button>
                        
                        <button 
                            v-else
                            class="btn btn-success" 
                            @click="finishExam"
                            :disabled="answeredCount === 0"
                        >
                            æäº¤æµ‹éªŒ
                        </button>
                    </div>
                </div>

                <!-- è€ƒè¯•ç»“æœ -->
                <div v-if="currentView === 'exam-result'" class="card result-card">
                    <h2>ğŸ‰ æµ‹éªŒå®Œæˆ</h2>
                    <p style="font-size: 24px; color: #666; margin: 20px 0;">
                        ç­”å¯¹äº† {{ examResult.correctCount }}/{{ examResult.totalQuestions }} é¢˜
                    </p>
                    
                    <!-- AIè¯„ä¼°æŠ¥å‘Š -->
                    <div v-if="aiReport || generatingReport" class="ai-report" style="margin-top: 30px; text-align: left;">
                        <h3 style="margin-bottom: 15px; text-align: center;">ğŸ¤– AIå­¦ä¹ è¯„ä¼°</h3>
                        <div v-if="generatingReport" class="ai-loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 15px;">AIæ­£åœ¨åˆ†æä½ çš„ç­”é¢˜æƒ…å†µï¼Œç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®...</p>
                        </div>
                        <div v-else>
                            {{ aiReport }}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                        <button class="btn btn-primary" @click="backToModeSelection">
                            è¿”å›é¦–é¡µ
                        </button>
                        <button class="btn btn-success" @click="startNewExam">
                            å†æ¬¡æµ‹éªŒ
                        </button>
                        <button class="btn btn-primary" @click="showAnswerReview">
                            ğŸ“ {{ showAnswers ? 'éšè—ç­”æ¡ˆ' : 'æŸ¥çœ‹ç­”æ¡ˆ' }}
                        </button>
                    </div>

                    <!-- ç­”æ¡ˆè§£æ -->
                    <div v-if="showAnswers" class="answer-review">
                        <h3 style="margin-bottom: 20px; text-align: left;">ğŸ“ ç­”æ¡ˆè§£æ</h3>
                        <div v-for="(question, index) in questions" :key="index" class="answer-item">
                            <div class="answer-question">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <span>{{ index + 1 }}. {{ question.question }}</span>
                                    <span class="question-type-badge" :class="question.type === 'multiple' ? 'multiple-choice' : 'single-choice'">
                                        {{ question.type === 'multiple' ? 'å¤šé€‰é¢˜' : 'å•é€‰é¢˜' }}
                                    </span>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #48bb78;">æ­£ç¡®ç­”æ¡ˆï¼š{{ question.answer }}</strong>
                                    <span style="margin-left: 20px; color: #666;">
                                        ä½ çš„ç­”æ¡ˆï¼š{{ userAnswers[index] || 'æœªä½œç­”' }}
                                    </span>
                                </div>
                            </div>
                            <div class="answer-options">
                                <!-- é€‰é¡¹A -->
                                <div v-if="question.optionA" 
                                     class="answer-option"
                                     :class="getAnswerOptionClass(question, 'A', userAnswers[index])">
                                    <strong>A.</strong> {{ question.optionA }}
                                    <span v-if="(question.answer || '').includes('A')"> âœ“ æ­£ç¡®ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('A') && !(question.answer || '').includes('A')"> âœ— ä½ çš„ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('A') && (question.answer || '').includes('A')"> âœ“ ä½ çš„æ­£ç¡®é€‰æ‹©</span>
                                </div>
                                
                                <!-- é€‰é¡¹B -->
                                <div v-if="question.optionB" 
                                     class="answer-option"
                                     :class="getAnswerOptionClass(question, 'B', userAnswers[index])">
                                    <strong>B.</strong> {{ question.optionB }}
                                    <span v-if="(question.answer || '').includes('B')"> âœ“ æ­£ç¡®ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('B') && !(question.answer || '').includes('B')"> âœ— ä½ çš„ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('B') && (question.answer || '').includes('B')"> âœ“ ä½ çš„æ­£ç¡®é€‰æ‹©</span>
                                </div>
                                
                                <!-- é€‰é¡¹C -->
                                <div v-if="question.optionC" 
                                     class="answer-option"
                                     :class="getAnswerOptionClass(question, 'C', userAnswers[index])">
                                    <strong>C.</strong> {{ question.optionC }}
                                    <span v-if="(question.answer || '').includes('C')"> âœ“ æ­£ç¡®ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('C') && !(question.answer || '').includes('C')"> âœ— ä½ çš„ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('C') && (question.answer || '').includes('C')"> âœ“ ä½ çš„æ­£ç¡®é€‰æ‹©</span>
                                </div>
                                
                                <!-- é€‰é¡¹D -->
                                <div v-if="question.optionD" 
                                     class="answer-option"
                                     :class="getAnswerOptionClass(question, 'D', userAnswers[index])">
                                    <strong>D.</strong> {{ question.optionD }}
                                    <span v-if="(question.answer || '').includes('D')"> âœ“ æ­£ç¡®ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('D') && !(question.answer || '').includes('D')"> âœ— ä½ çš„ç­”æ¡ˆ</span>
                                    <span v-if="(userAnswers[index] || '').includes('D') && (question.answer || '').includes('D')"> âœ“ ä½ çš„æ­£ç¡®é€‰æ‹©</span>
                                </div>
                            </div>
                            <div v-if="question.explanation" class="answer-explanation">
                                <strong>ğŸ’¡ è§£æï¼š</strong>{{ question.explanation }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†æ¨¡å— -->
            <div v-if="currentMainTab === 'admin' && isAdmin">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.totalQuestions }}</div>
                        <div class="stat-label">é¢˜åº“æ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.totalExams }}</div>
                        <div class="stat-label">è€ƒè¯•è®°å½•</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.averageScore }}%</div>
                        <div class="stat-label">å¹³å‡åˆ†æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.todayExams }}</div>
                        <div class="stat-label">ä»Šæ—¥è€ƒè¯•</div>
                    </div>
                </div>

                <!-- ç®¡ç†é€‰é¡¹å¡ -->
                <div class="card">
                    <div class="tabs">
                        <div 
                            class="tab" 
                            :class="{ active: activeTab === 'exams' }"
                            @click="activeTab = 'exams'; loadExamRecords()"
                        >
                            ğŸ“ è€ƒè¯•è®°å½•
                        </div>
                        <div 
                            class="tab" 
                            :class="{ active: activeTab === 'teams' }"
                            @click="activeTab = 'teams'; loadTeams()"
                        >
                            ğŸ‘¥ å›¢é˜Ÿç®¡ç†
                        </div>
                        <div 
                            class="tab" 
                            :class="{ active: activeTab === 'questions' }"
                            @click="activeTab = 'questions'; loadQuestions(); loadQuestionBanks()"
                        >
                            ğŸ“š é¢˜åº“ç®¡ç†
                        </div>
                        <div 
                            class="tab" 
                            :class="{ active: activeTab === 'config' }"
                            @click="activeTab = 'config'; loadConfig()"
                        >
                            âš™ï¸ ç³»ç»Ÿé…ç½®
                        </div>
                    </div>

                    <!-- è€ƒè¯•è®°å½•æ ‡ç­¾é¡µ -->
                    <div v-if="activeTab === 'exams'">
                        <input 
                            type="text" 
                            class="search-box" 
                            placeholder="æœç´¢è€ƒç”Ÿå§“å..." 
                            v-model="examSearch"
                        >
                        
                        <div v-if="loadingExams" class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 20px;">åŠ è½½è€ƒè¯•è®°å½•...</p>
                        </div>
                        
                        <table v-else class="table">
                            <thead>
                                <tr>
                                    <th>è€ƒç”Ÿå§“å</th>
                                    <th>åˆ†æ•°</th>
                                    <th>æ­£ç¡®ç‡</th>
                                    <th>è€ƒè¯•æ—¶é—´</th>
                                    <th>ç”¨æ—¶</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="exam in filteredExams" :key="exam.id">
                                    <td>{{ exam.userName || exam.user_name }}</td>
                                    <td>
                                        <span 
                                            class="score-badge"
                                            :class="getScoreClass(exam.score)"
                                        >
                                            {{ exam.score }}åˆ†
                                        </span>
                                    </td>
                                    <td>{{ Math.round((exam.correctCount / exam.totalQuestions) * 100) }}%</td>
                                    <td>{{ formatDate(exam.created_at) }}</td>
                                    <td>{{ formatDuration(exam.duration) }}</td>
                                    <td>
                                        <button class="btn btn-primary" @click="viewExamDetail(exam)">
                                            æŸ¥çœ‹è¯¦æƒ…
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- å›¢é˜Ÿç®¡ç†æ ‡ç­¾é¡µ -->
                    <div v-if="activeTab === 'teams'">
                        <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-success" @click="openCreateTeamModal">
                                â• åˆ›å»ºå›¢é˜Ÿ
                            </button>
                            <button class="btn btn-primary" @click="loadTeams">
                                ğŸ”„ åˆ·æ–°åˆ—è¡¨
                            </button>
                        </div>
                        
                        <div v-if="loadingTeams" class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 20px;">åŠ è½½å›¢é˜Ÿåˆ—è¡¨...</p>
                        </div>
                        
                        <table v-else class="table">
                            <thead>
                                <tr>
                                    <th>å›¢é˜Ÿåç§°</th>
                                    <th>å›¢é˜Ÿä»£ç </th>
                                    <th>æè¿°</th>
                                    <th>é¢˜åº“æ•°é‡</th>
                                    <th>é¢˜ç›®æ•°é‡</th>
                                    <th>è€ƒè¯•è®°å½•</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="team in teams" :key="team.id">
                                    <td>{{ team.name }}</td>
                                    <td><code>{{ team.code }}</code></td>
                                    <td>{{ team.description || '-' }}</td>
                                    <td>{{ team.banks_count }}</td>
                                    <td>{{ team.questions_count }}</td>
                                    <td>{{ team.exams_count }}</td>
                                    <td>
                                        <button class="btn btn-primary" @click="editTeam(team)" style="margin-right: 5px;">
                                            ç¼–è¾‘
                                        </button>
                                        <button v-if="team.id !== 1" class="btn btn-danger" @click="deleteTeam(team.id)">
                                            åˆ é™¤
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- é¢˜åº“ç®¡ç†æ ‡ç­¾é¡µ -->
                    <div v-if="activeTab === 'questions'">
                        <!-- å½“å‰é¢˜åº“é€‰æ‹© -->
                        <div style="background: #f0fff4; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; color: #4a5568;">ğŸ“š å½“å‰é¢˜åº“è®¾ç½®</h3>
                            <div style="display: grid; grid-template-columns: 2fr 2fr 1fr; gap: 15px; align-items: end;">
                                <div class="form-group" style="margin: 0;">
                                    <label>é€‰æ‹©å›¢é˜Ÿ</label>
                                    <select class="form-input" v-model="selectedTeamId" @change="loadQuestionBanks">
                                        <option v-for="team in teams" :key="team.id" :value="team.id">
                                            {{ team.name }}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label>é€‰æ‹©é¢˜åº“</label>
                                    <select class="form-input" v-model="selectedBankId">
                                        <option v-for="bank in teamQuestionBanks" :key="bank.id" :value="bank.id">
                                            {{ bank.name }} ({{ bank.questions_count }}é¢˜)
                                        </option>
                                    </select>
                                </div>
                                <button class="btn btn-success" @click="setCurrentBank" style="height: 48px;">
                                    âœ… è®¾ä¸ºå½“å‰é¢˜åº“
                                </button>
                            </div>
                            <div v-if="currentConfig" style="margin-top: 15px; color: #4a5568;">
                                <strong>å½“å‰ä½¿ç”¨ï¼š</strong>{{ currentConfig.team_name }} - {{ currentConfig.bank_name }}
                            </div>
                        </div>
                        
                        <!-- é¢˜åº“ç®¡ç†æ“ä½œ -->
                        <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-success" @click="openCreateBankModal">
                                â• åˆ›å»ºé¢˜åº“
                            </button>
                            <button class="btn btn-success" @click="openAddQuestionModal">
                                â• æ·»åŠ é¢˜ç›®
                            </button>
                            <button class="btn btn-primary" @click="refreshQuestions">
                                ğŸ”„ åˆ·æ–°æ•°æ®
                            </button>
                        </div>
                        
                        <div v-if="loadingQuestions" class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 20px;">åŠ è½½é¢˜åº“ç»Ÿè®¡...</p>
                        </div>
                        
                        <div v-else-if="questionStats">
                            <!-- é¢˜åº“ç»Ÿè®¡ä¿¡æ¯ -->
                            <div class="stats-grid" style="margin-bottom: 30px;">
                                <div class="stat-card">
                                    <div class="stat-value">{{ questionStats.total_questions }}</div>
                                    <div class="stat-label">é¢˜ç›®æ€»æ•°</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">{{ questionStats.statistics.single_choice }}</div>
                                    <div class="stat-label">å•é€‰é¢˜</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">{{ questionStats.statistics.multiple_choice }}</div>
                                    <div class="stat-label">å¤šé€‰é¢˜</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value">{{ questionStats.statistics.categories }}</div>
                                    <div class="stat-label">åˆ†ç±»æ•°é‡</div>
                                </div>
                            </div>
                            
                            <!-- é¢˜åº“åˆ—è¡¨ -->
                            <div v-if="teamQuestionBanks.length > 0" style="margin-top: 30px;">
                                <h3 style="margin-bottom: 15px; color: #4a5568;">ğŸ“š é¢˜åº“åˆ—è¡¨</h3>
                                <div class="question-banks-list">
                                    <div v-for="bank in teamQuestionBanks" :key="bank.id" class="bank-card">
                                        <div class="bank-info">
                                            <h4>{{ bank.name }}</h4>
                                            <p v-if="bank.description">{{ bank.description }}</p>
                                            <div class="bank-stats">
                                                <span class="stat-item">é¢˜ç›®æ•°é‡: {{ bank.questions_count || 0 }}</span>
                                                <span class="stat-item">åˆ›å»ºæ—¶é—´: {{ formatDate(bank.created_at) }}</span>
                                            </div>
                                        </div>
                                        <div class="bank-actions">
                                            <button class="btn btn-primary btn-sm" @click="openQuestionManager(bank)">
                                                ğŸ“ é¢˜ç›®ç®¡ç†
                                            </button>
                                            <button class="btn btn-danger btn-sm" @click="confirmDeleteBank(bank)" 
                                                    v-if="!isDefaultBank(bank)">
                                                ğŸ—‘ï¸ åˆ é™¤é¢˜åº“
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç³»ç»Ÿé…ç½®æ ‡ç­¾é¡µ -->
                    <div v-if="activeTab === 'config'">
                        <div v-if="loadingConfig" class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 20px;">åŠ è½½é…ç½®...</p>
                        </div>
                        
                        <div v-else>
                            <!-- APIé…ç½®éƒ¨åˆ† -->
                            <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                                <h3 style="margin-bottom: 20px;">ğŸ¤– AIé…ç½®</h3>
                                
                                <div class="form-group" style="margin-bottom: 20px;">
                                    <label>APIæä¾›å•†</label>
                                    <select class="form-input" v-model="apiConfig.provider">
                                        <option value="qwen">é€šä¹‰åƒé—® (Qwen)</option>
                                        <option value="openai">OpenAI</option>
                                        <option value="custom">è‡ªå®šä¹‰</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" style="margin-bottom: 20px;">
                                    <label>APIåœ°å€</label>
                                    <input 
                                        type="text" 
                                        class="form-input" 
                                        v-model="apiConfig.url" 
                                        placeholder="https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation"
                                    >
                                </div>
                                
                                <div class="form-group" style="margin-bottom: 20px;">
                                    <label>APIå¯†é’¥</label>
                                    <input 
                                        type="password" 
                                        class="form-input" 
                                        v-model="apiConfig.key" 
                                        placeholder="è¯·è¾“å…¥APIå¯†é’¥"
                                    >
                                </div>
                                
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button 
                                        class="btn btn-success" 
                                        @click="saveApiConfig"
                                        :disabled="savingConfig"
                                    >
                                        {{ savingConfig ? 'ä¿å­˜ä¸­...' : 'ğŸ’¾ ä¿å­˜é…ç½®' }}
                                    </button>
                                    
                                    <span v-if="connectionStatus" :style="{ color: connectionStatus.success ? '#48bb78' : '#f56565' }">
                                        {{ connectionStatus.message }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ é¢˜ç›®å¼¹çª— -->
        <div v-if="showAddQuestionModal" class="modal" @click="closeAddQuestionModal($event)">
            <div class="modal-content">
                <h2>æ·»åŠ æ–°é¢˜ç›®</h2>
                
                <div class="form-group">
                    <label>é€‰æ‹©é¢˜åº“</label>
                    <select class="form-input" v-model="questionForm.bank_id" required>
                        <option value="">è¯·é€‰æ‹©é¢˜åº“</option>
                        <option v-for="bank in teamQuestionBanks" :key="bank.id" :value="bank.id">
                            {{ bank.team_name }} - {{ bank.name }}
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>é¢˜ç›®åˆ†ç±»</label>
                    <input type="text" class="form-input" v-model="questionForm.category" placeholder="è¯·è¾“å…¥é¢˜ç›®åˆ†ç±»">
                </div>
                
                <div class="form-group">
                    <label>é¢˜ç›®ç±»å‹</label>
                    <select class="form-input" v-model="questionForm.question_type">
                        <option value="single">å•é€‰é¢˜</option>
                        <option value="multiple">å¤šé€‰é¢˜</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>é¢˜ç›®å†…å®¹</label>
                    <textarea class="form-input form-textarea" v-model="questionForm.question" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>é€‰é¡¹A</label>
                        <input type="text" class="form-input" v-model="questionForm.option_a" placeholder="é€‰é¡¹Aå†…å®¹">
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰é¡¹B</label>
                        <input type="text" class="form-input" v-model="questionForm.option_b" placeholder="é€‰é¡¹Bå†…å®¹">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>é€‰é¡¹Cï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" class="form-input" v-model="questionForm.option_c" placeholder="é€‰é¡¹Cå†…å®¹">
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰é¡¹Dï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" class="form-input" v-model="questionForm.option_d" placeholder="é€‰é¡¹Då†…å®¹">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>æ­£ç¡®ç­”æ¡ˆ</label>
                    <input type="text" class="form-input" v-model="questionForm.answer" 
                           :placeholder="questionForm.question_type === 'single' ? 'è¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼ˆå¦‚ï¼šAï¼‰' : 'è¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼ˆå¦‚ï¼šAB æˆ– ACDï¼‰'">
                </div>
                
                <div class="form-group">
                    <label>ç­”æ¡ˆè§£æï¼ˆå¯é€‰ï¼‰</label>
                    <textarea class="form-input form-textarea" v-model="questionForm.explanation" placeholder="è¯·è¾“å…¥ç­”æ¡ˆè§£æ"></textarea>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-primary" @click="closeAddQuestionModal(null)">å–æ¶ˆ</button>
                    <button class="btn btn-success" @click="saveQuestion" :disabled="!canSaveQuestion">
                        æ·»åŠ é¢˜ç›®
                    </button>
                </div>
            </div>
        </div>

        <!-- åˆ›å»ºå›¢é˜Ÿå¼¹çª— -->
        <div v-if="showCreateTeamModal" class="modal" @click="closeCreateTeamModal($event)">
            <div class="modal-content">
                <h2>{{ isEditTeamMode ? 'ç¼–è¾‘å›¢é˜Ÿ' : 'åˆ›å»ºæ–°å›¢é˜Ÿ' }}</h2>
                
                <div class="form-group">
                    <label>å›¢é˜Ÿåç§°</label>
                    <input type="text" class="form-input" v-model="teamForm.name" placeholder="è¯·è¾“å…¥å›¢é˜Ÿåç§°ï¼ˆå¦‚ï¼šå¿ƒè¡€ç®¡å›¢é˜Ÿï¼‰" 
                           :class="{ 'error': teamFormErrors.name }" @blur="validateTeamName">
                    <div v-if="teamFormErrors.name" class="error-message">{{ teamFormErrors.name }}</div>
                </div>
                
                <div class="form-group">
                    <label>å›¢é˜Ÿä»£ç </label>
                    <input type="text" class="form-input" v-model="teamForm.code" placeholder="è¯·è¾“å…¥å›¢é˜Ÿä»£ç ï¼ˆå¦‚ï¼šcardioï¼Œrespiratoryï¼‰"
                           :class="{ 'error': teamFormErrors.code }" @blur="validateTeamCode">
                    <div v-if="teamFormErrors.code" class="error-message">{{ teamFormErrors.code }}</div>
                    <small style="color: #718096; font-size: 12px; margin-top: 5px; display: block;">
                        å›¢é˜Ÿä»£ç ç”¨äºç³»ç»Ÿè¯†åˆ«ï¼Œå»ºè®®ä½¿ç”¨è‹±æ–‡ï¼Œåˆ›å»ºåä¸å»ºè®®ä¿®æ”¹
                    </small>
                </div>
                
                <div class="form-group">
                    <label>å›¢é˜Ÿæè¿°</label>
                    <textarea class="form-input form-textarea" v-model="teamForm.description" placeholder="è¯·è¾“å…¥å›¢é˜Ÿæè¿°"></textarea>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-primary" @click="cancelTeamModal">å–æ¶ˆ</button>
                    <button class="btn btn-success" @click="saveTeam">
                        {{ isEditTeamMode ? 'æ›´æ–°å›¢é˜Ÿ' : 'åˆ›å»ºå›¢é˜Ÿ' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- åˆ›å»ºé¢˜åº“å¼¹çª— -->
        <div v-if="showCreateBankModal" class="modal" @click="closeCreateBankModal($event)">
            <div class="modal-content">
                <h2>åˆ›å»ºæ–°é¢˜åº“</h2>
                
                <div class="form-group">
                    <label>æ‰€å±å›¢é˜Ÿ</label>
                    <select class="form-input" v-model="bankForm.team_id">
                        <option v-for="team in teams" :key="team.id" :value="team.id">
                            {{ team.name }}
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>é¢˜åº“åç§°</label>
                    <input type="text" class="form-input" v-model="bankForm.name" placeholder="è¯·è¾“å…¥é¢˜åº“åç§°ï¼ˆå¦‚ï¼šåŸºç¡€çŸ¥è¯†é¢˜åº“ï¼‰">
                </div>
                
                <div class="form-group">
                    <label>é¢˜åº“æè¿°</label>
                    <textarea class="form-input form-textarea" v-model="bankForm.description" placeholder="è¯·è¾“å…¥é¢˜åº“æè¿°"></textarea>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-primary" @click="closeCreateBankModal(null)">å–æ¶ˆ</button>
                    <button class="btn btn-success" @click="saveQuestionBank" :disabled="!canSaveBank">
                        åˆ›å»ºé¢˜åº“
                    </button>
                </div>
            </div>
        </div>

        <!-- é¢˜ç›®ç®¡ç†å¼¹çª— -->
        <div v-if="showQuestionManager" class="modal" @click="closeQuestionManager($event)">
            <div class="modal-content" style="max-width: 900px;">
                <h2>ğŸ“ é¢˜ç›®ç®¡ç† - {{ currentBank ? currentBank.name : '' }}</h2>
                
                <!-- ç®¡ç†æ¨¡å¼åˆ‡æ¢ -->
                <div style="margin-bottom: 20px;">
                    <div class="mode-tabs">
                        <button class="mode-tab" :class="{ active: questionManagerMode === 'view' }" 
                                @click="questionManagerMode = 'view'">
                            ğŸ“‹ æŸ¥çœ‹é¢˜ç›®
                        </button>
                        <button class="mode-tab" :class="{ active: questionManagerMode === 'add' }" 
                                @click="switchToAddMode" v-if="!isDefaultBank">
                            â• ä»é»˜è®¤é¢˜åº“é€‰æ‹©
                        </button>
                    </div>
                </div>
                
                <!-- æŸ¥çœ‹é¢˜ç›®æ¨¡å¼ -->
                <div v-if="questionManagerMode === 'view'">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div style="color: #4a5568;">
                            å…± {{ bankQuestions.length }} é“é¢˜ç›®
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success btn-sm" @click="addQuestionToBank">
                                â• æ·»åŠ æ–°é¢˜ç›®
                            </button>
                            <button class="btn btn-secondary btn-sm" @click="refreshBankQuestions">
                                ğŸ”„ åˆ·æ–°
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ä»é»˜è®¤é¢˜åº“é€‰æ‹©æ¨¡å¼ -->
                <div v-else-if="questionManagerMode === 'add'">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div style="color: #4a5568;">
                            ä»é»˜è®¤é¢˜åº“é€‰æ‹©é¢˜ç›®æ·»åŠ åˆ° {{ currentBank ? currentBank.name : '' }}
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" class="search-input" v-model="questionSearchText" 
                                   placeholder="æœç´¢é¢˜ç›®å†…å®¹ã€åˆ†ç±»..." @input="searchQuestions">
                            <button class="btn btn-primary btn-sm" @click="loadDefaultQuestions">
                                ğŸ”„ åˆ·æ–°
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- é¢˜ç›®åˆ—è¡¨ -->
                <div v-if="loadingBankQuestions || (questionManagerMode === 'add' && loadingDefaultQuestions)" class="loading">
                    <div class="spinner"></div>
                    <p>{{ loadingBankQuestions ? 'åŠ è½½é¢˜ç›®åˆ—è¡¨...' : 'åŠ è½½é»˜è®¤é¢˜åº“...' }}</p>
                </div>
                
                <!-- æŸ¥çœ‹æ¨¡å¼ - æ˜¾ç¤ºé¢˜åº“ä¸­çš„é¢˜ç›® -->
                <div v-else-if="questionManagerMode === 'view'">
                    <div v-if="bankQuestions.length === 0" class="no-data">
                        <p>{{ isDefaultBank ? 'æš‚æ— é¢˜ç›®' : 'è¯¥é¢˜åº“æš‚æ— é¢˜ç›®' }}</p>
                        <button class="btn btn-success" @click="addQuestionToBank">
                            â• ç«‹å³æ·»åŠ é¢˜ç›®
                        </button>
                    </div>
                    
                    <div v-else class="questions-list">
                        <div v-for="(question, index) in bankQuestions" :key="question.id" class="question-item">
                            <div class="question-header">
                                <span class="question-number">{{ index + 1 }}.</span>
                                <span class="question-type">{{ getQuestionTypeText(question.question_type) }}</span>
                                <span class="question-category">{{ question.category }}</span>
                            </div>
                            <div class="question-content">{{ question.question }}</div>
                            <div class="question-options" v-if="question.question_type === 'single' || question.question_type === 'multiple'">
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'A') }">
                                    A. {{ question.option_a }}
                                </div>
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'B') }">
                                    B. {{ question.option_b }}
                                </div>
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'C') }">
                                    C. {{ question.option_c }}
                                </div>
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'D') }">
                                    D. {{ question.option_d }}
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn btn-danger btn-sm" @click="confirmDeleteQuestion(question)" 
                                        v-if="!isDefaultBank || question.can_delete">
                                    ğŸ—‘ï¸ {{ isDefaultBank ? 'åˆ é™¤' : 'ç§»é™¤' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é€‰æ‹©æ¨¡å¼ - ä»é»˜è®¤é¢˜åº“é€‰æ‹©é¢˜ç›® -->
                <div v-else-if="questionManagerMode === 'add'">
                    <div v-if="filteredDefaultQuestions.length === 0" class="no-data">
                        <p>{{ questionSearchText ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¢˜ç›®' : 'é»˜è®¤é¢˜åº“æš‚æ— é¢˜ç›®' }}</p>
                    </div>
                    
                    <div v-else class="questions-list">
                        <div v-for="(question, index) in filteredDefaultQuestions" :key="question.id" 
                             class="question-item" :class="{ 'already-added': isQuestionInBank(question.id) }">
                            <div class="question-header">
                                <span class="question-number">{{ index + 1 }}.</span>
                                <span class="question-type">{{ getQuestionTypeText(question.question_type) }}</span>
                                <span class="question-category">{{ question.category }}</span>
                                <span v-if="isQuestionInBank(question.id)" class="added-badge">å·²æ·»åŠ </span>
                            </div>
                            <div class="question-content">{{ question.question }}</div>
                            <div class="question-options" v-if="question.question_type === 'single' || question.question_type === 'multiple'">
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'A') }">
                                    A. {{ question.option_a }}
                                </div>
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'B') }">
                                    B. {{ question.option_b }}
                                </div>
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'C') }">
                                    C. {{ question.option_c }}
                                </div>
                                <div class="option" :class="{ 'correct': isCorrectOption(question, 'D') }">
                                    D. {{ question.option_d }}
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn btn-success btn-sm" 
                                        @click="addQuestionFromDefault(question)"
                                        :disabled="isQuestionInBank(question.id)">
                                    {{ isQuestionInBank(question.id) ? 'âœ“ å·²æ·»åŠ ' : 'â• æ·»åŠ åˆ°é¢˜åº“' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-primary" @click="closeQuestionManager()">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
                    userName: 'æµ‹è¯•ç”¨æˆ·',
                    isAdmin: false,
                    
                    // ä¸»å¯¼èˆª
                    currentMainTab: 'exam', // exam, admin
                    
                    // è€ƒè¯•ç›¸å…³
                    currentView: 'daily-home', // daily-home, exam-in-progress, exam-result
                    selectedMode: 'daily',
                    dailyExamTime: '08:00 - 20:00',
                    isExamTimeActive: true,
                    todayExamRecord: null,
                    
                    // è€ƒè¯•æ•°æ®
                    questions: [],
                    currentQuestionIndex: 0,
                    userAnswers: {},
                    examStartTime: null,
                    examDuration: 0,
                    timeRemaining: 20 * 60,
                    timer: null,
                    examResult: null,
                    
                    // ç­”æ¡ˆå’ŒAIæŠ¥å‘Š
                    showAnswers: false,
                    aiReport: null,
                    generatingReport: false,
                    
                    // ç®¡ç†ç•Œé¢ç›¸å…³
                    activeTab: 'exams',
                    examSearch: '',
                    loadingExams: false,
                    loadingQuestions: false,
                    loadingConfig: false,
                    examRecords: [],
                    questionStats: null,
                    config: {},
                    
                    // å›¢é˜Ÿç®¡ç†
                    teams: [],
                    loadingTeams: false,
                    showCreateTeamModal: false,
                    isEditTeamMode: false,
                    editingTeamId: null,
                    teamForm: {
                        name: '',
                        code: '',
                        description: '',
                        is_active: true
                    },
                    teamFormErrors: {
                        name: '',
                        code: ''
                    },
                    
                    // é¢˜åº“ç®¡ç†
                    questionBanks: [],
                    teamQuestionBanks: [], // å½“å‰å›¢é˜Ÿçš„é¢˜åº“
                    loadingBanks: false,
                    showCreateBankModal: false,
                    selectedTeamId: 1,
                    selectedBankId: 1,
                    currentConfig: null,
                    bankForm: {
                        team_id: 1,
                        name: '',
                        description: '',
                        is_active: true
                    },
                    
                    // é¢˜ç›®ç®¡ç†
                    showAddQuestionModal: false,
                    questionForm: {
                        bank_id: null,
                        category: '',
                        question_type: 'single',
                        question: '',
                        option_a: '',
                        option_b: '',
                        option_c: '',
                        option_d: '',
                        answer: '',
                        explanation: ''
                    },
                    
                    // é¢˜ç›®ç®¡ç†å™¨
                    showQuestionManager: false,
                    currentBank: null,
                    bankQuestions: [],
                    loadingBankQuestions: false,
                    questionManagerMode: 'view', // 'view' æˆ– 'add'
                    defaultQuestions: [], // é»˜è®¤é¢˜åº“ä¸­çš„æ‰€æœ‰é¢˜ç›®
                    loadingDefaultQuestions: false,
                    questionSearchText: '',
                    filteredDefaultQuestions: [],
                    
                    // APIé…ç½®
                    apiConfig: {
                        provider: 'qwen',
                        url: 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation',
                        model: 'qwen-turbo',
                        key: ''
                    },
                    savingConfig: false,
                    connectionStatus: null,
                    
                    stats: {
                        totalQuestions: 0,
                        totalExams: 0,
                        averageScore: 0,
                        todayExams: 0
                    },
                    
                    apiBase: '/api'
                }
            },
            computed: {
                currentQuestion() {
                    return this.questions[this.currentQuestionIndex];
                },
                progressPercent() {
                    return ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                },
                answeredCount() {
                    return Object.keys(this.userAnswers).length;
                },
                filteredExams() {
                    if (!this.examSearch) return this.examRecords;
                    return this.examRecords.filter(exam => 
                        (exam.userName || exam.user_name || '').toLowerCase()
                            .includes(this.examSearch.toLowerCase())
                    );
                },
                canSaveQuestion() {
                    return this.questionForm.category.trim() && 
                           this.questionForm.question.trim() && 
                           this.questionForm.option_a.trim() && 
                           this.questionForm.option_b.trim() && 
                           this.questionForm.answer.trim();
                },
                canSaveTeam() {
                    return this.teamForm.name.trim() && this.teamForm.code.trim();
                },
                canSaveBank() {
                    return this.bankForm.team_id && this.bankForm.name.trim();
                }
            },
            async mounted() {
                // æ£€æµ‹ç”¨æˆ·æƒé™
                await this.detectUserPermissions();
                
                // åˆå§‹åŒ–
                await this.initializeDailyExam();
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼ŒåŠ è½½ç®¡ç†æ•°æ®
                if (this.isAdmin) {
                    await this.loadStats();
                    await this.loadTeams();
                    await this.loadQuestions();
                    await this.loadCurrentConfig();
                }
            },
            methods: {
                // æƒé™æ£€æµ‹
                async detectUserPermissions() {
                    // ç®€å•çš„æƒé™æ£€æµ‹ï¼šåŒ…å«adminçš„ç”¨æˆ·åè¢«è§†ä¸ºç®¡ç†å‘˜
                    if (this.userName.toLowerCase().includes('admin') || 
                        this.userName.toLowerCase().includes('ç®¡ç†å‘˜') ||
                        this.userName === 'æµ‹è¯•ç”¨æˆ·') {
                        this.isAdmin = true;
                    }
                },
                
                // ä¸»æ ‡ç­¾åˆ‡æ¢
                switchMainTab(tab) {
                    this.currentMainTab = tab;
                    if (tab === 'admin' && this.isAdmin) {
                        this.loadStats();
                        this.loadExamRecords();
                    }
                },
                
                // åˆå§‹åŒ–æ¯æ—¥æµ‹éªŒ
                async initializeDailyExam() {
                    try {
                        // è·å–æ¯æ—¥è€ƒè¯•é…ç½®
                        const configResponse = await axios.get(`${this.apiBase}/daily-exam-config`);
                        const config = configResponse.data.config;
                        
                        this.dailyExamTime = `${config.daily_exam_start_time} - ${config.daily_exam_end_time}`;
                        this.isExamTimeActive = this.isWithinDailyExamTime(config.daily_exam_start_time, config.daily_exam_end_time);
                        
                        // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²å®Œæˆæµ‹éªŒ
                        await this.checkTodayExamRecord();
                        
                    } catch (error) {
                        console.error('åˆå§‹åŒ–æ¯æ—¥æµ‹éªŒå¤±è´¥:', error);
                    }
                },
                
                async checkTodayExamRecord() {
                    try {
                        const today = new Date().toISOString().split('T')[0];
                        const response = await axios.get(`${this.apiBase}/exam-records`, {
                            params: { 
                                exam_type: 'daily_exam',
                                date: today
                            }
                        });
                        
                        // æŸ¥æ‰¾ä»Šæ—¥è®°å½•
                        const todayRecord = response.data.find(record => {
                            const recordDate = new Date(record.created_at).toISOString().split('T')[0];
                            return recordDate === today;
                        });
                        
                        this.todayExamRecord = todayRecord;
                        
                    } catch (error) {
                        console.error('æ£€æŸ¥ä»Šæ—¥è€ƒè¯•è®°å½•å¤±è´¥:', error);
                    }
                },
                
                backToModeSelection() {
                    this.currentView = 'daily-home';
                    this.selectedMode = 'daily';
                    this.questions = [];
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.examResult = null;
                    this.showAnswers = false;
                    this.aiReport = null;
                    this.generatingReport = false;
                    this.stopTimer();
                    
                    // é‡æ–°æ£€æŸ¥ä»Šæ—¥è€ƒè¯•è®°å½•
                    this.checkTodayExamRecord();
                },
                
                async startDailyExam() {
                    // æ£€æŸ¥æ¯æ—¥æµ‹éªŒæ—¶é—´
                    try {
                        const configResponse = await axios.get(`${this.apiBase}/daily-exam-config`);
                        const config = configResponse.data.config;
                        
                        if (!this.isWithinDailyExamTime(config.daily_exam_start_time, config.daily_exam_end_time)) {
                            alert(`æ¯æ—¥æµ‹éªŒæ—¶é—´ä¸º ${config.daily_exam_start_time} - ${config.daily_exam_end_time}ï¼Œè¯·åœ¨å¼€æ”¾æ—¶é—´å†…å‚åŠ æµ‹éªŒ`);
                            return;
                        }
                        
                        this.selectedMode = 'daily';
                        const response = await axios.get(`${this.apiBase}/questions`, {
                            params: { 
                                limit: config.daily_exam_question_count || 3, 
                                random_sample: true 
                            }
                        });
                        this.questions = response.data;
                        this.timeRemaining = (config.daily_exam_duration_minutes || 10) * 60; // 10åˆ†é’Ÿé™æ—¶
                        this.startExamSession();
                    } catch (error) {
                        alert('åŠ è½½ç»ƒä¹ é¢˜ç›®å¤±è´¥: ' + error.message);
                    }
                },
                
                isWithinDailyExamTime(startTime, endTime) {
                    const now = new Date();
                    const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    
                    const start = startTime.replace(':', '');
                    const end = endTime.replace(':', '');
                    const current = currentTime.replace(':', '');
                    
                    return current >= start && current <= end;
                },
                
                startExamSession() {
                    this.currentView = 'exam-in-progress';
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.examStartTime = Date.now();
                    this.showAnswers = false;
                    this.aiReport = null;
                    this.startTimer();
                },
                
                // è€ƒè¯•æ§åˆ¶
                selectAnswer(option) {
                    const questionIndex = this.currentQuestionIndex;
                    const question = this.questions[questionIndex];
                    
                    if (question.type === 'multiple') {
                        // å¤šé€‰é¢˜é€»è¾‘
                        let currentAnswers = this.userAnswers[questionIndex] || '';
                        
                        if (currentAnswers.includes(option)) {
                            // å–æ¶ˆé€‰æ‹©
                            currentAnswers = currentAnswers.replace(option, '');
                        } else {
                            // æ·»åŠ é€‰æ‹©ï¼ŒæŒ‰å­—æ¯é¡ºåºæ’åº
                            currentAnswers += option;
                            currentAnswers = currentAnswers.split('').sort().join('');
                        }
                        
                        this.userAnswers[questionIndex] = currentAnswers;
                    } else {
                        // å•é€‰é¢˜é€»è¾‘
                        this.userAnswers[questionIndex] = option;
                    }
                },
                
                isOptionSelected(option) {
                    try {
                        const questionIndex = this.currentQuestionIndex;
                        const userAnswer = this.userAnswers[questionIndex] || '';
                        const question = this.questions[questionIndex];
                        
                        if (question && question.type === 'multiple') {
                            return userAnswer.includes(option);
                        } else {
                            return userAnswer === option;
                        }
                    } catch (error) {
                        console.error('isOptionSelected error:', error);
                        return false;
                    }
                },
                
                nextQuestion() {
                    if (this.currentQuestionIndex < this.questions.length - 1) {
                        this.currentQuestionIndex++;
                    }
                },
                
                previousQuestion() {
                    if (this.currentQuestionIndex > 0) {
                        this.currentQuestionIndex--;
                    }
                },
                
                async finishExam() {
                    if (this.answeredCount === 0) {
                        alert('è¯·è‡³å°‘å›ç­”ä¸€é“é¢˜ç›®');
                        return;
                    }

                    this.stopTimer();
                    this.examDuration = Math.floor((Date.now() - this.examStartTime) / 1000);
                    
                    // è®¡ç®—æˆç»©
                    let correctCount = 0;
                    for (let i = 0; i < this.questions.length; i++) {
                        const userAnswer = this.userAnswers[i];
                        const correctAnswer = this.questions[i].answer;
                        if (userAnswer === correctAnswer) {
                            correctCount++;
                        }
                    }

                    const score = Math.round((correctCount / this.questions.length) * 100);
                    
                    this.examResult = {
                        score: score,
                        correctCount: correctCount,
                        totalQuestions: this.questions.length
                    };

                    // æäº¤è€ƒè¯•è®°å½•
                    try {
                        await this.submitExamRecord();
                    } catch (error) {
                        console.error('æäº¤è€ƒè¯•è®°å½•å¤±è´¥:', error);
                    }

                    this.currentView = 'exam-result';
                },
                
                async submitExamRecord() {
                    const recordId = `${this.selectedMode}_${Date.now()}`;
                    
                    // æ„å»ºå®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼ŒåŒ…å«ç”¨æˆ·ç­”æ¡ˆ
                    const questionsWithAnswers = this.questions.map((question, index) => ({
                        question: question.question,
                        optionA: question.optionA,
                        optionB: question.optionB,
                        optionC: question.optionC,
                        optionD: question.optionD,
                        correct_answer: question.answer,
                        user_answer: this.userAnswers[index] || '',
                        question_type: question.type,
                        category: question.category,
                        explanation: question.explanation || '',
                        is_correct: (this.userAnswers[index] || '').toUpperCase() === question.answer.toUpperCase()
                    }));
                    
                    const examData = {
                        id: recordId,
                        userName: this.userName,
                        score: this.examResult.score,
                        correctCount: this.examResult.correctCount,
                        totalQuestions: this.examResult.totalQuestions,
                        duration: this.examDuration,
                        exam_type: this.selectedMode === 'daily' ? 'daily_exam' : 'practice',
                        detailed_answers: this.userAnswers,
                        questions_data: questionsWithAnswers
                    };

                    // å¼€å§‹ç”ŸæˆAIæŠ¥å‘Š
                    this.generatingReport = true;
                    
                    await axios.post(`${this.apiBase}/exam-records`, examData);
                    
                    // ç­‰å¾…AIæŠ¥å‘Šç”Ÿæˆå®Œæˆï¼ˆå¼‚æ­¥è½®è¯¢ï¼‰
                    this.waitForAIReport(recordId);
                },
                
                startNewExam() {
                    this.currentView = 'daily-home';
                    this.selectedMode = 'daily';
                    this.questions = [];
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.examResult = null;
                    this.showAnswers = false;
                    this.aiReport = null;
                    this.generatingReport = false;
                    this.timeRemaining = 10 * 60;
                    this.stopTimer();
                    
                    // é‡æ–°æ£€æŸ¥ä»Šæ—¥è€ƒè¯•è®°å½•
                    this.checkTodayExamRecord();
                },
                
                // é¢˜ç›®ç®¡ç†æ–¹æ³•
                openQuestionManager(bank) {
                    this.currentBank = bank;
                    this.showQuestionManager = true;
                    this.questionManagerMode = 'view';
                    this.questionSearchText = '';
                    this.filteredDefaultQuestions = [];
                    this.loadBankQuestions(bank.id);
                },
                
                closeQuestionManager(event) {
                    if (event && event.target && !event.target.classList.contains('modal')) {
                        return;
                    }
                    this.showQuestionManager = false;
                    this.currentBank = null;
                    this.bankQuestions = [];
                    this.questionManagerMode = 'view';
                    this.questionSearchText = '';
                    this.filteredDefaultQuestions = [];
                    this.defaultQuestions = [];
                },
                
                switchToAddMode() {
                    this.questionManagerMode = 'add';
                    this.loadDefaultQuestions();
                },
                
                async loadBankQuestions(bankId) {
                    this.loadingBankQuestions = true;
                    try {
                        const response = await axios.get(`${this.apiBase}/question-banks/${bankId}/questions`);
                        this.bankQuestions = response.data;
                    } catch (error) {
                        console.error('åŠ è½½é¢˜åº“é¢˜ç›®å¤±è´¥:', error);
                        alert('åŠ è½½é¢˜åº“é¢˜ç›®å¤±è´¥');
                    } finally {
                        this.loadingBankQuestions = false;
                    }
                },
                
                refreshBankQuestions() {
                    if (this.currentBank) {
                        this.loadBankQuestions(this.currentBank.id);
                    }
                },
                
                async loadDefaultQuestions() {
                    this.loadingDefaultQuestions = true;
                    try {
                        // è·å–é»˜è®¤é¢˜åº“ï¼ˆæ‰€æœ‰master-questionsï¼‰
                        const response = await axios.get(`${this.apiBase}/master-questions`);
                        this.defaultQuestions = response.data;
                        this.filteredDefaultQuestions = response.data;
                        this.searchQuestions(); // åº”ç”¨æœç´¢è¿‡æ»¤
                    } catch (error) {
                        console.error('åŠ è½½é»˜è®¤é¢˜åº“å¤±è´¥:', error);
                        alert('åŠ è½½é»˜è®¤é¢˜åº“å¤±è´¥');
                    } finally {
                        this.loadingDefaultQuestions = false;
                    }
                },
                
                searchQuestions() {
                    if (!this.questionSearchText.trim()) {
                        this.filteredDefaultQuestions = this.defaultQuestions;
                        return;
                    }
                    
                    const searchText = this.questionSearchText.toLowerCase();
                    this.filteredDefaultQuestions = this.defaultQuestions.filter(question => 
                        question.question.toLowerCase().includes(searchText) ||
                        question.category.toLowerCase().includes(searchText) ||
                        question.option_a?.toLowerCase().includes(searchText) ||
                        question.option_b?.toLowerCase().includes(searchText) ||
                        question.option_c?.toLowerCase().includes(searchText) ||
                        question.option_d?.toLowerCase().includes(searchText)
                    );
                },
                
                isQuestionInBank(questionId) {
                    return this.bankQuestions.some(q => q.id === questionId);
                },
                
                async addQuestionFromDefault(question) {
                    try {
                        // å°†é¢˜ç›®æ·»åŠ åˆ°å½“å‰é¢˜åº“
                        await axios.post(`${this.apiBase}/question-banks/${this.currentBank.id}/questions`, {
                            question_id: question.id
                        });
                        
                        alert('é¢˜ç›®æ·»åŠ æˆåŠŸï¼');
                        this.refreshBankQuestions(); // åˆ·æ–°å½“å‰é¢˜åº“
                        this.loadQuestionBanks(); // åˆ·æ–°é¢˜åº“åˆ—è¡¨
                        
                    } catch (error) {
                        alert('æ·»åŠ é¢˜ç›®å¤±è´¥: ' + (error.response?.data?.detail || error.message));
                        console.error(error);
                    }
                },
                
                addQuestionToBank() {
                    // è®¾ç½®é¢˜ç›®è¡¨å•çš„ç›®æ ‡é¢˜åº“
                    this.questionForm.bank_id = this.currentBank.id;
                    this.resetQuestionForm();
                    this.showQuestionManager = false; // å…ˆå…³é—­é¢˜ç›®ç®¡ç†å™¨
                    this.showAddQuestionModal = true; // æ‰“å¼€æ·»åŠ é¢˜ç›®è¡¨å•
                },
                
                confirmDeleteQuestion(question) {
                    if (confirm(`ç¡®å®šè¦åˆ é™¤é¢˜ç›®"${question.question}"å—ï¼Ÿ`)) {
                        this.deleteQuestion(question);
                    }
                },
                
                async deleteQuestion(question) {
                    try {
                        await axios.delete(`${this.apiBase}/questions/${question.id}`);
                        alert('é¢˜ç›®åˆ é™¤æˆåŠŸï¼');
                        this.refreshBankQuestions();
                        this.loadQuestionBanks(); // åˆ·æ–°é¢˜åº“åˆ—è¡¨ä»¥æ›´æ–°é¢˜ç›®æ•°é‡
                    } catch (error) {
                        alert('åˆ é™¤é¢˜ç›®å¤±è´¥: ' + (error.response?.data?.detail || error.message));
                        console.error(error);
                    }
                },
                
                getQuestionTypeText(type) {
                    switch(type) {
                        case 'single': return 'å•é€‰é¢˜';
                        case 'multiple': return 'å¤šé€‰é¢˜';
                        case 'true_false': return 'åˆ¤æ–­é¢˜';
                        default: return type;
                    }
                },
                
                isCorrectOption(question, option) {
                    return question.answer && question.answer.includes(option);
                },
                
                formatDate(dateString) {
                    if (!dateString) return '';
                    return new Date(dateString).toLocaleDateString('zh-CN');
                },

                // å·¥å…·æ–¹æ³•
                startTimer() {
                    if (this.selectedMode === 'daily' && this.timeRemaining > 0) {
                        this.timer = setInterval(() => {
                            this.timeRemaining--;
                            if (this.timeRemaining <= 0) {
                                this.finishExam();
                            }
                        }, 1000);
                    }
                },
                
                stopTimer() {
                    if (this.timer) {
                        clearInterval(this.timer);
                        this.timer = null;
                    }
                },
                
                formatTime(seconds) {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                },
                
                // ç­”æ¡ˆè§£æç›¸å…³
                showAnswerReview() {
                    this.showAnswers = !this.showAnswers;
                },
                
                getAnswerOptionClass(question, option, userAnswer) {
                    const correctAnswer = question.answer || '';
                    const isCorrect = correctAnswer.includes(option);
                    const isUserSelected = (userAnswer || '').includes(option);
                    
                    if (isCorrect && isUserSelected) {
                        return 'correct'; // æ­£ç¡®ç­”æ¡ˆä¸”ç”¨æˆ·é€‰æ‹©äº†
                    } else if (isCorrect && !isUserSelected) {
                        return 'correct'; // æ­£ç¡®ç­”æ¡ˆä½†ç”¨æˆ·æœªé€‰æ‹©
                    } else if (!isCorrect && isUserSelected) {
                        return 'wrong'; // é”™è¯¯ç­”æ¡ˆä½†ç”¨æˆ·é€‰æ‹©äº†
                    } else {
                        return 'not-selected'; // æœªé€‰æ‹©
                    }
                },
                
                // ç­‰å¾…AIæŠ¥å‘Šç”Ÿæˆå®Œæˆ
                async waitForAIReport(recordId) {
                    try {
                        let attempts = 0;
                        const maxAttempts = 30; // æœ€å¤šç­‰å¾…30æ¬¡ï¼Œæ¯æ¬¡2ç§’ï¼Œæ€»å…±60ç§’
                        
                        const checkReport = async () => {
                            try {
                                const response = await axios.get(`${this.apiBase}/exam-records/${recordId}`);
                                
                                if (response.data.ai_report) {
                                    this.aiReport = response.data.ai_report;
                                    this.generatingReport = false;
                                    return true;
                                }
                                
                                attempts++;
                                if (attempts >= maxAttempts) {
                                    console.log('AIæŠ¥å‘Šç”Ÿæˆè¶…æ—¶');
                                    this.generatingReport = false;
                                    return false;
                                }
                                
                                // 2ç§’åå†æ¬¡æ£€æŸ¥
                                setTimeout(checkReport, 2000);
                                return false;
                                
                            } catch (error) {
                                console.error('æ£€æŸ¥AIæŠ¥å‘ŠçŠ¶æ€å¤±è´¥:', error);
                                this.generatingReport = false;
                                return false;
                            }
                        };
                        
                        // å¼€å§‹æ£€æŸ¥
                        checkReport();
                        
                    } catch (error) {
                        console.error('ç­‰å¾…AIæŠ¥å‘Šå¤±è´¥:', error);
                        this.generatingReport = false;
                    }
                },
                
                // ç®¡ç†ç•Œé¢æ–¹æ³•
                async loadStats() {
                    try {
                        // è·å–é¢˜åº“ç»Ÿè®¡
                        const questionsRes = await axios.get(`${this.apiBase}/master-questions`);
                        this.stats.totalQuestions = questionsRes.data.totalQuestions;
                        
                        // è·å–è€ƒè¯•è®°å½•ç»Ÿè®¡
                        const examsRes = await axios.get(`${this.apiBase}/exam-records`);
                        const exams = examsRes.data;
                        this.stats.totalExams = exams.length;
                        
                        if (exams.length > 0) {
                            const totalScore = exams.reduce((sum, exam) => sum + exam.score, 0);
                            this.stats.averageScore = Math.round(totalScore / exams.length);
                            
                            // è®¡ç®—ä»Šæ—¥è€ƒè¯•æ•°
                            const today = new Date().toDateString();
                            this.stats.todayExams = exams.filter(exam => 
                                new Date(exam.created_at).toDateString() === today
                            ).length;
                        }
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
                    }
                },
                
                async loadExamRecords() {
                    this.loadingExams = true;
                    try {
                        const response = await axios.get(`${this.apiBase}/exam-records`);
                        this.examRecords = response.data;
                    } catch (error) {
                        alert('åŠ è½½è€ƒè¯•è®°å½•å¤±è´¥: ' + error.message);
                    } finally {
                        this.loadingExams = false;
                    }
                },
                
                async loadQuestions() {
                    this.loadingQuestions = true;
                    try {
                        const response = await axios.get(`${this.apiBase}/questions/stats`);
                        this.questionStats = response.data;
                    } catch (error) {
                        alert('åŠ è½½é¢˜åº“ç»Ÿè®¡å¤±è´¥: ' + error.message);
                    } finally {
                        this.loadingQuestions = false;
                    }
                },
                
                async loadConfig() {
                    this.loadingConfig = true;
                    try {
                        const response = await axios.get(`${this.apiBase}/master-config`);
                        this.config = response.data;
                        
                        // å¦‚æœå·²æœ‰é…ç½®ï¼ŒåŠ è½½åˆ°è¡¨å•ä¸­
                        if (this.config.apiConfig) {
                            this.apiConfig = {
                                provider: this.config.apiConfig.provider || 'qwen',
                                url: this.config.apiConfig.url || 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation',
                                model: this.config.apiConfig.model || 'qwen-turbo',
                                key: this.config.apiConfig.key || ''
                            };
                        }
                    } catch (error) {
                        alert('åŠ è½½é…ç½®å¤±è´¥: ' + error.message);
                    } finally {
                        this.loadingConfig = false;
                    }
                },
                
                async refreshQuestions() {
                    await this.loadQuestions();
                    await this.loadStats();
                    alert('é¢˜åº“å·²åˆ·æ–°');
                },
                
                // é¢˜åº“ç®¡ç†æ–¹æ³•
                async openAddQuestionModal() {
                    this.resetQuestionForm();
                    // ç¡®ä¿åŠ è½½æ‰€æœ‰é¢˜åº“ä¾›é€‰æ‹©
                    await this.loadAllQuestionBanks();
                    this.showAddQuestionModal = true;
                },
                
                resetQuestionForm() {
                    this.questionForm = {
                        bank_id: this.questionForm.bank_id || null, // ä¿æŒå·²è®¾ç½®çš„é¢˜åº“IDæˆ–æ¸…ç©º
                        category: '',
                        question_type: 'single',
                        question: '',
                        option_a: '',
                        option_b: '',
                        option_c: '',
                        option_d: '',
                        answer: '',
                        explanation: ''
                    };
                },
                
                closeAddQuestionModal(event) {
                    if (event && event.target && !event.target.classList.contains('modal')) {
                        return;
                    }
                    this.showAddQuestionModal = false;
                    this.resetQuestionForm();
                },
                
                async saveQuestion() {
                    if (!this.canSaveQuestion) {
                        alert('è¯·å¡«å†™å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯');
                        return;
                    }
                    
                    try {
                        // æ·»åŠ é¢˜ç›®åˆ°master-questionsï¼ˆé»˜è®¤é¢˜åº“ï¼‰
                        const response = await axios.post(`${this.apiBase}/master-questions`, this.questionForm);
                        
                        // å¦‚æœæŒ‡å®šäº†ç‰¹å®šé¢˜åº“ï¼Œä¹Ÿæ·»åŠ åˆ°è¯¥é¢˜åº“
                        if (this.questionForm.bank_id) {
                            try {
                                await axios.post(`${this.apiBase}/question-banks/${this.questionForm.bank_id}/questions`, {
                                    question_id: response.data.id
                                });
                            } catch (error) {
                                console.error('æ·»åŠ åˆ°é¢˜åº“å¤±è´¥:', error);
                            }
                        }
                        
                        alert('é¢˜ç›®æ·»åŠ æˆåŠŸï¼é¢˜ç›®å·²è‡ªåŠ¨æ·»åŠ åˆ°é»˜è®¤é¢˜åº“ã€‚');
                        this.closeAddQuestionModal();
                        this.loadQuestions();
                        this.loadStats();
                        this.loadQuestionBanks(); // æ›´æ–°é¢˜åº“åˆ—è¡¨
                        
                        // å¦‚æœé¢˜ç›®ç®¡ç†å™¨æ˜¯æ‰“å¼€çš„ï¼Œæ›´æ–°é¢˜ç›®åˆ—è¡¨
                        if (this.showQuestionManager && this.currentBank && this.currentBank.id === this.questionForm.bank_id) {
                            this.refreshBankQuestions();
                        }
                        
                        // å¦‚æœæ­£åœ¨æŸ¥çœ‹é»˜è®¤é¢˜åº“ï¼Œåˆ·æ–°é»˜è®¤é¢˜åº“åˆ—è¡¨
                        if (this.questionManagerMode === 'add') {
                            this.loadDefaultQuestions();
                        }
                        
                    } catch (error) {
                        alert('æ·»åŠ é¢˜ç›®å¤±è´¥: ' + error.message);
                        console.error(error);
                    }
                },
                
                viewExamDetail(exam) {
                    alert(`è€ƒè¯•è¯¦æƒ…ï¼š\nå§“å: ${exam.userName || exam.user_name}\nåˆ†æ•°: ${exam.score}åˆ†\nç”¨æ—¶: ${this.formatDuration(exam.duration)}`);
                },
                
                getScoreClass(score) {
                    if (score >= 90) return 'score-excellent';
                    if (score >= 70) return 'score-good';
                    return 'score-poor';
                },
                
                formatDate(dateString) {
                    if (!dateString) return '-';
                    return new Date(dateString).toLocaleString('zh-CN');
                },
                
                formatDuration(seconds) {
                    if (!seconds) return '-';
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}åˆ†${secs}ç§’`;
                },
                
                // å›¢é˜Ÿç®¡ç†æ–¹æ³•
                async loadTeams() {
                    this.loadingTeams = true;
                    try {
                        const response = await axios.get(`${this.apiBase}/teams`);
                        this.teams = response.data;
                        
                        // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„å›¢é˜Ÿï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
                        if (this.teams.length > 0 && !this.selectedTeamId) {
                            this.selectedTeamId = this.teams[0].id;
                        }
                    } catch (error) {
                        alert('åŠ è½½å›¢é˜Ÿåˆ—è¡¨å¤±è´¥: ' + error.message);
                    } finally {
                        this.loadingTeams = false;
                    }
                },
                
                openCreateTeamModal() {
                    this.isEditTeamMode = false;
                    this.editingTeamId = null;
                    this.resetTeamForm();
                    this.showCreateTeamModal = true;
                },
                
                editTeam(team) {
                    this.isEditTeamMode = true;
                    this.editingTeamId = team.id;
                    this.teamForm = {
                        name: team.name,
                        code: team.code,
                        description: team.description || '',
                        is_active: team.is_active
                    };
                    this.showCreateTeamModal = true;
                },
                
                resetTeamForm() {
                    this.teamForm = {
                        name: '',
                        code: '',
                        description: '',
                        is_active: true
                    };
                    this.teamFormErrors = {
                        name: '',
                        code: ''
                    };
                },
                
                validateTeamName() {
                    if (!this.teamForm.name.trim()) {
                        this.teamFormErrors.name = 'è¯·è¾“å…¥å›¢é˜Ÿåç§°';
                        return false;
                    } else {
                        this.teamFormErrors.name = '';
                        return true;
                    }
                },
                
                validateTeamCode() {
                    if (!this.teamForm.code.trim()) {
                        this.teamFormErrors.code = 'è¯·è¾“å…¥å›¢é˜Ÿä»£ç ';
                        return false;
                    } else {
                        this.teamFormErrors.code = '';
                        return true;
                    }
                },
                
                validateTeamForm() {
                    const nameValid = this.validateTeamName();
                    const codeValid = this.validateTeamCode();
                    return nameValid && codeValid;
                },
                
                closeCreateTeamModal(event) {
                    // å¦‚æœæ˜¯ç‚¹å‡»æ¨¡æ€æ¡†å†…å®¹åŒºåŸŸï¼Œä¸å…³é—­
                    if (event && event.target && !event.target.classList.contains('modal')) {
                        return;
                    }
                    // å¦‚æœæ˜¯æŒ‰é’®ç‚¹å‡»æˆ–ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯ï¼Œå…³é—­æ¨¡æ€æ¡†
                    this.showCreateTeamModal = false;
                    this.resetTeamForm();
                },
                
                cancelTeamModal() {
                    this.showCreateTeamModal = false;
                    this.resetTeamForm();
                },
                
                async saveTeam() {
                    if (!this.validateTeamForm()) {
                        return;
                    }
                    
                    try {
                        if (this.isEditTeamMode) {
                            await axios.put(`${this.apiBase}/teams/${this.editingTeamId}`, this.teamForm);
                            alert('å›¢é˜Ÿæ›´æ–°æˆåŠŸï¼');
                        } else {
                            await axios.post(`${this.apiBase}/teams`, this.teamForm);
                            alert('å›¢é˜Ÿåˆ›å»ºæˆåŠŸï¼');
                        }
                        
                        this.closeCreateTeamModal();
                        this.loadTeams();
                        this.loadStats();
                        
                    } catch (error) {
                        alert(`${this.isEditTeamMode ? 'æ›´æ–°' : 'åˆ›å»º'}å›¢é˜Ÿå¤±è´¥: ` + error.response?.data?.detail || error.message);
                        console.error(error);
                    }
                },
                
                async deleteTeam(teamId) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå›¢é˜Ÿå—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                        return;
                    }
                    
                    try {
                        await axios.delete(`${this.apiBase}/teams/${teamId}`);
                        alert('å›¢é˜Ÿåˆ é™¤æˆåŠŸï¼');
                        this.loadTeams();
                        this.loadStats();
                    } catch (error) {
                        alert('åˆ é™¤å›¢é˜Ÿå¤±è´¥: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                confirmDeleteBank(bank) {
                    if (confirm(`ç¡®å®šè¦åˆ é™¤é¢˜åº“"${bank.name}"å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼`)) {
                        this.deleteQuestionBank(bank);
                    }
                },
                
                async deleteQuestionBank(bank) {
                    try {
                        await axios.delete(`${this.apiBase}/question-banks/${bank.id}`);
                        alert('é¢˜åº“åˆ é™¤æˆåŠŸï¼');
                        this.loadQuestionBanks();
                        this.loadTeams(); // åˆ·æ–°å›¢é˜Ÿç»Ÿè®¡
                        
                    } catch (error) {
                        alert('åˆ é™¤é¢˜åº“å¤±è´¥: ' + (error.response?.data?.detail || error.message));
                        console.error(error);
                    }
                },
                
                // é¢˜åº“ç®¡ç†æ–¹æ³•
                async loadQuestionBanks() {
                    try {
                        const response = await axios.get(`${this.apiBase}/question-banks?team_id=${this.selectedTeamId}`);
                        this.teamQuestionBanks = response.data;
                        
                        // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„é¢˜åº“ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
                        if (this.teamQuestionBanks.length > 0 && !this.selectedBankId) {
                            this.selectedBankId = this.teamQuestionBanks[0].id;
                        }
                    } catch (error) {
                        console.error('åŠ è½½é¢˜åº“åˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                
                async loadAllQuestionBanks() {
                    try {
                        const response = await axios.get(`${this.apiBase}/question-banks`);
                        this.teamQuestionBanks = response.data;
                    } catch (error) {
                        console.error('åŠ è½½æ‰€æœ‰é¢˜åº“å¤±è´¥:', error);
                    }
                },
                
                async loadCurrentConfig() {
                    try {
                        const response = await axios.get(`${this.apiBase}/current-config`);
                        this.currentConfig = response.data;
                        
                        // æ›´æ–°é€‰æ‹©çš„å›¢é˜Ÿå’Œé¢˜åº“
                        this.selectedTeamId = response.data.current_team_id;
                        this.selectedBankId = response.data.current_bank_id;
                    } catch (error) {
                        console.error('åŠ è½½å½“å‰é…ç½®å¤±è´¥:', error);
                    }
                },
                
                async setCurrentBank() {
                    if (!this.selectedTeamId || !this.selectedBankId) {
                        alert('è¯·é€‰æ‹©å›¢é˜Ÿå’Œé¢˜åº“');
                        return;
                    }
                    
                    try {
                        const response = await axios.post(`${this.apiBase}/set-current-bank?team_id=${this.selectedTeamId}&bank_id=${this.selectedBankId}`);
                        
                        alert('å½“å‰é¢˜åº“è®¾ç½®æˆåŠŸï¼');
                        await this.loadCurrentConfig();
                        
                    } catch (error) {
                        alert('è®¾ç½®å½“å‰é¢˜åº“å¤±è´¥: ' + (error.response?.data?.detail || error.message));
                    }
                },
                
                openCreateBankModal() {
                    this.resetBankForm();
                    this.showCreateBankModal = true;
                },
                
                resetBankForm() {
                    this.bankForm = {
                        team_id: this.selectedTeamId || 1,
                        name: '',
                        description: '',
                        is_active: true
                    };
                },
                
                closeCreateBankModal(event) {
                    if (event && event.target && !event.target.classList.contains('modal')) {
                        return;
                    }
                    this.showCreateBankModal = false;
                    this.resetBankForm();
                },
                
                async saveQuestionBank() {
                    if (!this.canSaveBank) {
                        alert('è¯·å¡«å†™å®Œæ•´çš„é¢˜åº“ä¿¡æ¯');
                        return;
                    }
                    
                    try {
                        await axios.post(`${this.apiBase}/question-banks`, this.bankForm);
                        alert('é¢˜åº“åˆ›å»ºæˆåŠŸï¼');
                        
                        this.closeCreateBankModal();
                        this.loadQuestionBanks();
                        this.loadTeams(); // æ›´æ–°å›¢é˜Ÿç»Ÿè®¡
                        
                    } catch (error) {
                        alert('åˆ›å»ºé¢˜åº“å¤±è´¥: ' + (error.response?.data?.detail || error.message));
                        console.error(error);
                    }
                },
                
                // APIé…ç½®ç›¸å…³æ–¹æ³•
                async saveApiConfig() {
                    this.savingConfig = true;
                    this.connectionStatus = null;
                    
                    try {
                        const configData = {
                            provider: this.apiConfig.provider,
                            url: this.apiConfig.url,
                            model: this.apiConfig.model,
                            key: this.apiConfig.key,
                            enabled: true
                        };
                        
                        const response = await axios.post(`${this.apiBase}/api-config`, configData);
                        
                        if (response.data.success) {
                            this.connectionStatus = {
                                success: true,
                                message: 'âœ… APIé…ç½®ä¿å­˜æˆåŠŸï¼'
                            };
                            await this.loadConfig(); // é‡æ–°åŠ è½½é…ç½®
                            await this.loadStats(); // æ›´æ–°ç»Ÿè®¡
                        } else {
                            this.connectionStatus = {
                                success: false,
                                message: 'âŒ APIé…ç½®ä¿å­˜å¤±è´¥: ' + response.data.message
                            };
                        }
                        
                    } catch (error) {
                        this.connectionStatus = {
                            success: false,
                            message: 'âŒ ä¿å­˜é…ç½®å¤±è´¥: ' + error.message
                        };
                        console.error(error);
                    } finally {
                        this.savingConfig = false;
                    }
                },
                
                isDefaultBank(bank = null) {
                    const targetBank = bank || this.currentBank;
                    return targetBank && (targetBank.name === 'é»˜è®¤é¢˜åº“' || targetBank.is_default || targetBank.id === 1);
                }
            },
            beforeUnmount() {
                this.stopTimer();
            }
        }).mount('#app');
    </script>
</body>
</html>